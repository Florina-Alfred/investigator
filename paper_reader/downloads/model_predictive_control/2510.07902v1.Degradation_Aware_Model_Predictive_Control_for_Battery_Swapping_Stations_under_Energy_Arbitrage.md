## Degradation-Aware Model Predictive Control for Battery Swapping Stations under Energy Arbitrage

Ruochen Li 1 , Zhichao Chen 1 , Zhaoting Zhang 1 , Renjie Guo 2 , Zhankun Sun 2 , Jiwei Yao 3 , Jiaze Ma 1 *

1 Department of Systems Engineering, City University of Hong Kong, Kowloon, Hong Kong, China 2 Department of Decision Analytics and Operations, City University of Hong Kong, Kowloon, Hong Kong, China 3 Department of Chemical Engineering, University of Utah, Salt Lake City, UT, USA

## Abstract

Battery swapping stations (BSS) offer a fast and scalable alternative to conventional electric vehicle (EV) charging, gaining growing policy support worldwide. However, existing BSS control strategies typically rely on heuristics or low-fidelity degradation models, limiting profitability and service level. This paper proposes BSS-MPC: a real-time, degradation-aware Model Predictive Control (MPC) framework for BSS operations to trade off economic incentives from energy market arbitrage and long-term battery degradation effects. BSS-MPC integrates a high-fidelity, physicsinformed battery aging model that accurately predicts the degradation level and the remaining capacity of battery packs. The resulting multiscale optimization-jointly considering energy arbitrage, swapping logistics, and battery health-is formulated as a mixed-integer optimal control problem and solved with tailored algorithms. Simulation results show that BSS-MPC outperforms rule-based and low-fidelity baselines, achieving lower energy cost, reduced capacity fade, and strict satisfaction of EV swapping demands.

Keywords: Model Predictive Control, Battery Swapping, Energy Market.

## 1 Introduction

The global shift toward electric vehicle (EVs) is accelerating. Yet, despite progress in battery and charging technologies, two obstacles continue to limit EV adoption: range anxiety and charging bottlenecks. Drivers remain concerned about running out of power during long trips, especially on highways. While in densely populated urban areas where people lack private charging space, peak charging demand (e.g. during holidays) often results in long queues and hours of waiting. For highutilization EV such as taxis, buses, and trucks, every minute of downtime directly translates into lost productivity [1].

BSS offer a solution to these problems by allowing EV drivers to replace a depleted battery with a fully charged one in just a few minutes. A well-known example is NIO's BSS, which consists of two integrated components: a garage that robotically swaps the battery packs and a charging stack that holds and recharges 21 depleted batteries [2]. NIO's fully automated stations can complete

* Corresponding author: jiazema@cityu.edu.hk

a battery exchange in about three minutes [3]. Compared with fast charging, BSS eliminates long wait times while avoiding the heavy grid loads and accelerated battery degradation caused by fast charging. Beyond convenience, BSS also decouple battery ownership from vehicle ownership, which can reduce the upfront cost of EVs for consumers. Centralized battery handling also enables efficient recycling and lifecycle management of EV battery [4].

Recent years have witnessed substantial policy and industrial momentum for battery swapping. For example, NIO has deployed more than 3500 BSS cross China and provided battery swapping service over 87 million times [5]. Ecosystem leaders like Gogoro [6] and Ample [7] have initiated swap networks for both two- and four-wheelers. Major policy initiatives in China [8] and pilot programs in the US and Europe [9] reflect a growing consensus that integrating battery swapping with smart grid management accelerates sustainable mobility.

Despite demonstrated technical feasibility-most visibly in Tesla's early battery-swap trials-market adoption has lagged because economics, not engineering, are the binding constraint [10, 11]. A BSS requires upfront investment and ongoing maintenance, while consumers' willingness to pay service fees is limited [12]. Pricing high erodes demand; pricing low impedes cost recovery-producing a profitability dilemma that has hindered large-scale deployment.

A promising path forward is to treat the BSS not only as a mobility service but also as a gridintegrated energy storage asset. By adopting operational modes that co-optimize swapping with energy arbitrage-charging during low-price periods and discharging (or offsetting purchases) during high-price periods-the BSS can augment revenue and/or reduce electricity cost. This dual role reframes station operation from cost center to value-creating flexibility resource. For example, NIO's newly deployed BSS can store up to 21 EV batteries with a total capacity of 2.1 MWh. Leveraging this energy reservoir creates an additional revenue stream that enhances the economic viability of the stations. Specifically, advanced operation can unlock three key benefits[13, 14, 12]:

- Demand-driven preparation: Given the swapping demand over a short horizon, the station can proactively charge selected batteries in advance. It ensures sufficient availability of fully charged batteries at all times while avoiding last-minute rushes.
- Market-aware energy scheduling: Given the electricity price trends, the system can strategically shift charging to low-price periods and discharge during high-price intervals, thereby maximizing profit and enhancing participation in energy markets.
- Degradation-aware operation: Since battery aging is influenced by usage patterns, state-ofcharge levels, and current profiles, integrating battery degradation models into control decisions allows the station to extend battery life. This mitigates long-term economic loss casued by the degradation of EV battery.

The above factors position BSS as a systems that must balance real-time service reliability, longterm asset health, and economics. Yet implementing predictive, health-aware control in real time is challenging: high-fidelity degradation models entail nonlinear dynamics and high-dimensional state spaces, leading to computational burden [15]. Conversely, simplified models and heuristic batterymanagement rules constrain the station's ability to fully exploit its value as a grid-integrated energy storage resource.

To overcome these challenges, this paper proposes a MPC framework of BSS with integrated energy market arbitrage. By incorporating a high-fidelity battery degradation model via a compu-

tationally efficient surrogate, the framework enables real-time, degradation-aware decision-making across both battery swapping logistics and grid-level energy transactions. This model-based strategy not only ensures short-term operational efficiency but also promotes long-term battery health.

Organization: The remainder of this manuscript is organized as follows. Section 2 provides a review of existing studies and identifies the open challenges that still need to be resolved. Building on these insights, our proposed control framework is detailed in Section 3. Finally, in Section Section 4, we first present the results of overall charging and discharging within a prediction horizon, illustrating the response of BSS-MPC to price and demand fluctuations. This part includes a comparison between the planning results at the initial time step and the results obtained from rolling horizon optimization, showing how the control inputs are adjusted and gradually differ as the sliding window progresses in section 4.1. In the second part of the experiment section 4.2, we assess the effectiveness of BSS-MPC by comparing it with other methods, including rule-based and simplified model baselines.

## 2 Literature Review

Early studies used either rule-based or simplified battery model to schedule charging, discharging and swapping in BSS. The models in [16, 17, 18] simply classified battery states into fully charged, half-charged, half-discharged, or empty to enable a straightforward management strategy. The rulebased BSS scheduling model in [19] charges only during off-peak hours to minimize cost, permits but deprioritizes mid-peak charging, and avoids peak-hour charging entirely. The model in [20] uses empirical formulas to approximate battery charging status without considering the detailed battery electrochemistry, relying instead on a simplified constant current-voltage estimation model. To account for battery evolution characteristics and exploit grid arbitrage, subsequent studies on BSS operation moved beyond heuristic and rule-based strategies. In [21], the model in [20] is extended with a surrogate for battery aging. The objective is to maintain a high stock of swappable batteries (service reliability) while minimizing charging-induced degradation; However, long-term arbitrage opportunities are not considered. [22, 23] represent state-of-charge (SOC) dynamics as a linear function of charging and discharging power, while battery degradation was approximated-also linearly-as a function of charging and discharging power. The problem is cast as an optimal control and solved in a rolling-horizon manner. However, these simplifications -such as discretizing charging/discharging modes and linearizing nonlinear effects-induce cumulative errors and degrade forecasting accuracy over long horizons.

Although MPC gradually emerged as the mainstream framework for BSS scheduling [24, 25, 26], most implementations deliver implementable rules but typically on simplified battery state models, again curbing fidelity for aging and long-run arbitrage valuation. Parallel works [27, 28, 29] from the market perspective frames the BSS as a price-taker optimizing participation across day ahead /real time/ ancillary services with demand forecasts are useful to expose multi-market value streams, but most studies either omit explicit electrochemical aging or approximate it coarsely, which biases longhorizon economics.

To address computational challenges from complex electrochemistry and combinatorics, recent learning-based studies use reinforcement learning (RL) for fast online decisions, sometimes paired with a post-hoc optimization layer-for example, a DRL-optimization cascade for scalable BSS energy management [30] and RL policies with degradation/waiting-time penalties in the reward [31]. While these approaches scale, they typically encode hard constraints and battery health only indi-

rectly (via penalties or post-processing), or rely heavily on offline training that makes performance sensitive to model assumptions, and they provide limited optimality guarantees. Consequently, they still fall short of solving the full mixed-integer, health-aware arbitrage problem at high fidelity. Decomposition schemes likewise highlight the computational burden and depend on model simplifications to remain tractable [32].

We observed that two gaps recur across the literature:

1. Battery-model fidelity: Aging physics and its feedback on efficiency and usable capacity are often simplified, degrading the valuation of long-term arbitrage and risking inventory shortfalls;
2. Tractability: Health-aware, high-fidelity scheduling couples nonlinear battery dynamics with integer swap/charge decisions, making the problem computationally hard; most works therefore revert to simplified states.

There is a growing body of work showing that high-fidelity, degradation-aware models can materially improve stationary battery arbitrage decisions. Reniers et al. [33] compare physics-based model and low-fidelity surrogates over year-long arbitrage and show substantially better revenue-lifetime valuation with the high fidelity physics-based model. Building on this, Cao et al. [15] embed a physics-based battery in a multiscale MPC with a terminal fade penalty, demonstrating closed-loop feasibility and large lifetime/profit gains versus low-fidelity MPC. Complementing these, Perez et al. [34] solve optimal control directly on an electrochemical-thermal model with state constraints, illustrating how high-order dynamics can be handled numerically and how constraints map to practical charging/dispatch policies. These works indicate that high-fidelity control is tractable and economically meaningful for stationary storage-motivating our BSS extension, where integer swap logistics and service-level constraints introduce additional combinatorial complexity.

To address the aforementioned challenges, this paper presents, to the best of our knowledge, the first computational framework that systematically integrates a high-precision, physics-informed, degradation-aware model with MPC for real-time operation of BSS participating in energy market arbitrage. The main contributions are summarized as follows:

1. We formulate the BSS operation problem as a finite-horizon optimal control problem within a multiscale framework. This formulation explicitly captures the coupling between short-term energy dispatch decisions and long-term battery degradation dynamics under volatile electricity market signals.
2. To address the computational difficulties brought by the high-fidelity battery degradation model, we replace the original Single Particle Model (SPM) with a Kriging-based surrogate model that preserves the high-fidelity characteristics of both battery degradation behavior and charge/discharge dynamics, while largely enhancing computational efficiency and numerical stability. This enables the integration of battery aging effects into real-time MPC.
3. We solve the resulting optimal control problem as a mixed-integer nonlinear programming (MINLP) problem and develop a tailored MPC framework, namely BSS-MPC . This framework leverages updated surrogate models and receding-horizon optimization to achieve coordinated decision-making with improved economic performance and enhanced battery longevity.

Figure 1: Schematic of BSS management with energy market arbitrage.

<!-- image -->

## 3 Proposed Approach

The application context of the proposed BSS-MPC framework is depicted in Figure 1. We assume that the system operates within a Day-Ahead Market of PJM [35], where electricity prices and battery swapping demands are known in advance and vary on an hourly basis (we consider a deterministic process). Based on energy prices and demands over a future time horizon, the BSS makes optimal scheduling decisions using high-fidelity degradation and charging models. Additionally, we assume that batteries supplied to EVs always operate within a specified SOC working range under stable discharge conditions, such that battery life degradation due to EV usage can be neglected. The goal is to maximize operational profit by strategically purchasing or selling electricity to charge batteries for future swapping, thereby enabling energy arbitrage. Meanwhile, the system must ensure that sufficiently charged batteries are always available to meet real-time swapping requests from EV drivers.

This chapter is organized as follows:

- Section 3.1 introduces the high-fidelity electrochemical battery model, including both charge/discharge dynamics and degradation behavior.
- Section 3.2 develops a Kriging-based surrogate model that approximates the high-fidelity model while alleviating computational burdens of the optimization problem.
- Section 3.3 formulates the operation of BSS as a finite-horizon mixed-integer optimal control problem.
- Section 3.4 presents the proposed BSS-MPC framework, which solves the resulting MINLP problem in a receding-horizon fashion.

## 3.1 Single Particle Model

High-fidelity lithium-ion battery models are typically formulated using the SPM [36]. By neglecting electrolyte concentration gradients and simplifying radial diffusion in active particles, the SPM significantly reduces computational complexity while retaining the essential physics for tracking SOC and degradation. This simplification makes it particularly suitable for MPC, especially at moderate or low charge/discharge power levels where the simplifications introduce minimal error.

The SPM equations presented in this section are adapted from [15], and the corresponding parameter set stems from a comprehensive identification campaign on LiFePO 4 cells via repeated voltage/current cycling experiments reported in [37]. Table 1 summarizes the variables and parameters used in the SPM. The variables classified as state evolve according to differential equations,

Table 1: Variables and Parameters in the Single Particle Model

| Symbol              | Description                                                                   | Unit                   | Type      |
|---------------------|-------------------------------------------------------------------------------|------------------------|-----------|
| C avg p , C avg n   | Average lithium concentration (positive/negative electrodes)                  | mol / m 3              | State     |
| δ SEI               | SEI (Solid Electrolyte Interphase) layer thickness                            | m                      | State     |
| c f                 | Cumulative capacity fade                                                      | Ah                     | State     |
| P                   | Applied power (positive: discharging to grid; nega- tive: charging from grid) | MW                     | Input     |
| C surf p , C surf n | Surface lithium concentration (positive/negative elec- trodes)                | mol / m 3              | Algebraic |
| i int               | Internal current                                                              | A                      | Algebraic |
| ϕ p , ϕ n           | Solid-phase potentials in positive/negative electrodes                        | V                      | Algebraic |
| pot                 | Terminal voltage of the battery                                               | V                      | Algebraic |
| i                   | Total current through the battery                                             | A                      | Algebraic |
| i SEI               | Current due to SEI side reaction                                              | A                      | Algebraic |
| θ p , θ n           | Normalized surface lithium concentration ratio                                |                        | Algebraic |
| U p , U n           | Open-circuit potentials of positive/negative elec- trodes                     | V                      | Algebraic |
| J p , J n           | Reaction current density per unit electroactive surface area                  | A / m 2                | Algebraic |
| D p , D n           | Solid phase diffusivity (positive/negative electrodes)                        | m 2 / s                | Constant  |
| R p , R n F         | Particles radius (positive/negative electrodes)                               | m                      | Constant  |
| a p ,a n            | Faraday's constant Particle surface area to volume (positive/negative         | 96 , 485C / mol        | Constant  |
| l p , l n           | electrodes) Region thickness (positive/negative electrodes)                   | m 2 / m 3              | Constant  |
|                     |                                                                               | m                      | Constant  |
| k p ,k n            | Rate for lithium intercalation reaction (positive/nega- tive electrodes)      | m 2 . 5 / (mol 0 . 5 · | Constant  |
| C e                 | Electrolyte lithium-ion concentration                                         | mol / m 3              | Constant  |
| κ SEI               | Ionic conductivity of SEI layer                                               | S / m                  | Constant  |
| T                   | Temporature                                                                   | K                      | Constant  |
| ρ SEI               | Average density of the SEI layer                                              | Kg / m 3               | Constant  |
| M SEI               | Molecular weight of the SEI layer                                             | Kg / mol               | Constant  |
| U ref               | SEI growth onset voltage at negative electrode                                | V                      | Constant  |
| C max p , C max n   | Maximum solid phase concentration (positive/nega- tive electrodes)            | mol / m 3              | Constant  |

while those labeled as algebraic are determined solely by algebraic constraints. The input variables correspond to the control inputs of the system. All remaining quantities are fixed parameters,.

In SPM, assuming isothermal operation, the governing equations can be organized into five major components: lithium concentration dynamics within the electrode particles, the open-circuit voltages (OCVs) of the electrodes, interfacial electrochemical reaction kinetics, side reactions and Solid Elec-

trolyte Interphase (SEI) film growth, and the resulting capacity fade and energy output. Each component collectively captures the interplay between diffusion, reaction thermodynamics, degradation, and macroscopic power, as detailed in the following key aspects.

## Lithium Concentration Dynamics

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

The temporal evolution of the average lithium concentration in the spherical particles of the positive ( p ) and negative ( n ) electrodes is described by Equation (3.2). This equation represents the dominant diffusion-driven dynamics inside each particle. The relationships in Equations (3.3) and (3.4) connect the average concentration to the surface concentration by imposing flux balance at the particle surface, thereby linking the diffusion field to the macroscopic current flow. These simplified expressions, which are actually derived as approximations from the boundary flux balance condition rather than by solving the full diffusion equation, eliminate the need to explicitly solve the full radial diffusion equation, while retaining the essential physics needed to track the electrodes' SOC with adequate accuracy for control purposes.

Open-Circuit Voltage (OCV) Based on empirical fits to OCV-SOC measurements for LiFePO 4 -based cells, U p and U n are expressed as:

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

where f p and f n are smooth functions capturing the nonlinear dependence of the OCV on the stateof-charge.

## Butler-Volmer Reaction Currents

The intercalation and deintercalation of lithium ions at the electrode-electrolyte interfaces are modeled using Butler-Volmer kinetics. Equations (3.7) and (3.8) express the reaction current densities at the positive and negative electrodes as nonlinear functions of the local surface concentrations, overpotentials, and reaction rate parameters. By linking these reaction currents with the concentration dynamics, the model establishes a consistent bridge between the applied current and the underlying electrochemical processes, which ultimately govern charge transfer and polarization behavior.

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

## SEI Side Reaction, Film Growth and Capacity Fade

At the negative electrode, parasitic side reactions lead to the formation and growth of the Solid Electrolyte Interphase (SEI) film. The SEI reaction current i SEI and the evolution of the film thickness δ SEI are given by the governing equations above. These reactions not only consume active lithium, reducing the cell's available capacity over time, but also increase interfacial resistance, altering the battery's dynamic response. By integrating the SEI current over time, the model captures cumulative capacity fade c f , allowing it to predict the gradual degradation of the battery over its operating life.

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

## Current, Voltage and Power

The terminal power output of the cell is determined by the product of the terminal voltage and the total applied current, as expressed in Equation (3.13). The total current i is the sum of the intercalation current i int and the parasitic SEI side reaction current i SEI, as given by the current balance relation:

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

The charging power P is often described using the C-rate, which indicates how fast a battery is charged relative to its capacity-for example, 1C means full charge in one hour, 2C in half an hour.

Collectively, this formulation ensures current conservation while consistently linking the internal electrochemical processes-both reversible (intercalation) and irreversible (SEI growth)-to the macroscopic power flow at the cell terminals.

## 3.2 Kriging Surrogate

Equations (3.2) to (3.13) form a Differential-Algebraic Equation (DAE) system and were implemented in earlier work by Cao et al.[15] for the arbitrage decision of a single battery. However, BSS involve multiple battery models and discrete decisions regarding which battery to swap, making even SPM still overly complex. In particular, the presence of exponential and hyperbolic sine terms often leads to severe numerical instability, making the problem extremely difficult to solve efficiently. To tackle this challenge, we adopt a surrogate modeling approach based on a Kriging model. This significantly simplifies the optimization problem while largely preserving the model's accuracy.

Kriging, originally developed in the field of spatial statistics, is a powerful spatial interpolation technique used for making optimal predictions at arbitrary spatial locations [38, 39]. Due to its high prediction accuracy and low number of function evaluations [40], Kriging is well-suited to serve as a surrogate model. Its underlying model is:

<!-- formula-not-decoded -->

Here, µ ( x ) represents the deterministic trend component (mean function), and δ ( x ) is a zero-mean stochastic process that models spatial correlation through a covariance function. In practice, the mean function is often chosen as a constant or a linear function. In this work, we adopt a constant mean function, i.e., µ ( x ) = µ 0 . The covariance function, also known as the kernel, encodes the similarity between input points and plays a key role in defining the smoothness and generalization ability of the surrogate model.

Given a set of training inputs X and corresponding outputs y = f ( X ) , the Kriging predictor at a new input x ∗ follows a normal distribution with the following mean and variance:

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

In these expressions:

- K is the covariance matrix of the training samples,
- k ∗ is the covariance vector between the test point x ∗ and the training inputs X ,
- k ∗∗ is the self-covariance of the test point.

All covariance terms are computed using the selected kernel function k ( · , · ) . Acommonlyusedkernel is the Radial Basis Function (RBF), also known as the squared exponential kernel, defined as:

<!-- formula-not-decoded -->

where:

- x, x ′ are input vectors, and D is the dimension of x .
- θ d is the length scale parameter, which controls the sensitivity of the function to differences in the input;

## Kriging Surrogate for SPM

For the battery model, the state vector x consists of the four key state variables C avg p , C avg n , δ SEI, and c f , while the control input u corresponds to the power input P . By retaining only these dominant dynamic states and omitting numerous algebraic variables, we simplify the original DAE system into a tractable ordinary differential equation (ODE) model, which serves as the basis for the surrogate construction. The Kriging surrogate is trained to approximate the state increment, formulated as

<!-- formula-not-decoded -->

where ∆ x i +1 represents the change in the state between two consecutive time steps i and i+1. This incremental formulation is particularly beneficial for accurately capturing the monotonically increasing behavior of δ SEI and c f , as directly modeling the absolute states tends to introduce bias and reduce fidelity for such slowly varying, cumulative quantities. The actual state evolution is then obtained by integrating this increment:

<!-- formula-not-decoded -->

Figure 2: Histogram of Kriging fitting for C avg p , C avg n , δ SEI, and c f

<!-- image -->

It is worth noting that we fit the state transition model in the form of backward integration. This choice leads to a more compact representation of the entire BSS model, as will be further elaborated in Section 3.3.

Input-output data pairs are generated offline by directly performing numerical integration on the DAEsystem Equations (3.2) to (3.13) using the IDA solver[41, 42, 43]. We constructed a dataset by numerically integrating the evolution of a battery from its initial state through randomized charge-discharge cycles until reaching end-of-life. Based on this high-fidelity dataset, a surrogate model is trained to approximate the battery dynamics. By omitting the algebraic variables present in the original electrochemical model, we reduce the system to a set of ODEs, lowering the computational complexity while maintaining accuracy. Importantly, since the surrogate model is trained on data sampled from the original continuous-time model, its prediction error remains consistent with the true dynamics regardless of the discretization step size. This allows us to use a relatively large time step when

solving optimal control problems without sacrificing accuracy.

We use maximum likelihood estimation (MLE) to train the kriging model. The fitting accuracy of the resulting Kriging surrogate model is illustrated in Figure 2, where the relative error distribution is visualized using kernel density estimation. As shown, the surrogate achieves excellent agreement with the original model across all state variables. In particular, the slowly varying degradationrelated states δ SEI (Figure 2c) and c f (Figure 2d) exhibit relative errors concentrated within ± 0 . 002 , indicating highly accurate approximation. For the more dynamic concentration-related states C avg p (Figure 2a) and C avg n (Figure 2b), the surrogate maintains errors within ± 0 . 03 , with the error distribution sharply centered around zero and no noticeable bias.

While the MPC framework requires repeated trajectory rollouts over the prediction horizon, only the first control input is applied at each time step during closed-loop execution. This recedinghorizon structure inherently mitigates the impact of small prediction errors. Overall, the Kriging surrogate offers a computationally efficient yet sufficiently accurate representation of the original SPM, capturing both state-of-charge dynamics and capacity fade, and thus providing a reliable foundation for multiscale BSS operational optimization.

## 3.3 Optimal Control of BSS

To account for both fast operational dynamics and slow battery aging, we formulate a multiscale model of the BSS that integrates swapping logistics, electrochemical behavior, and degradation. Viewing this as a control system, we pose a finite-horizon mixed-integer optimal control problem that links short-term decisions with long-term health, forming the basis of the predictive strategy in the next section.

## 3.3.1 State Transition Model

Weconsider a deterministic framework for modeling the dynamics of a BSS, where exogenous factors - such as real-time electricity prices and vehicle arrival patterns - are assumed to be known a priori and treated as time-dependent inputs to the system. The analysis is based on two primary datasets: historical Day-Ahead Market energy prices from PJM Interconnection for a one-year period and historical hourly customer swapping demand records from NIO's BSS located at the Shanghai Changtai International Financial Center. Furthermore, we assume that the batteries used in EVs discharge in a stable manner within their appropriate operating range, and thus capacity degradation is neglected. To capture the hourly fluctuations in electricity prices and to simplify computation, we discretize the system dynamics using a 1-hour time step ( ∆ t = 1 h). A 1-hour interval is sufficient for full battery charging under the considered C-rate conditions. The state and control variables at these grid points are discretized as follow,

<!-- formula-not-decoded -->

Let K be the total number of batteries in the station. The state vector at time step i is defined as:

<!-- formula-not-decoded -->

where the state of each battery k is:

<!-- formula-not-decoded -->

The control input at time step i is:

<!-- formula-not-decoded -->

where P k,i denotes the net power exchanged between battery k and the grid at step i (positive for discharging/selling, negative for charging/buying).

To model swapping operations, we introduce a binary selection vector for step 1 to N:

<!-- formula-not-decoded -->

where b k,i = 1 if battery k is selected for swapping at step i , and b k,i = 0 otherwise. The number of batteries to be swapped, denoted S i , is assumed to be known at each step i , with the constraint:

<!-- formula-not-decoded -->

The discrete-time state transition with swapping is expressed as:

<!-- formula-not-decoded -->

where:

- x swap is the state of a freshly swapped battery, assumed to be fixed and known.
- ∆ x i +1 represents the state increment from system dynamics, as described in Equations (3.18) to (3.19).

Using a surrogate model to approximate the backward state update (via ∆ x i +1 ) instead of a forward one simplifies the formulation. If the forward form were used, we would need to track two separate increments, ∆ x swap and ∆ x i , leading to:

<!-- formula-not-decoded -->

which significantly complicates the model.

To maintain physical realism, only batteries with an SOC above a minimum threshold are eligible for swapping:

<!-- formula-not-decoded -->

ensuring that swapping occurs only when a battery has sufficient charge. The term ε compensates for the Kriging-induced approximation error and ensures the feasibility of swapping constraints during numerical optimization.

<!-- formula-not-decoded -->

## 3.3.2 Objective Function

The optimization objective balances economic profitability with long-term battery health preservation. It combines a reward term R and a penalty term P , forming the total objective:

<!-- formula-not-decoded -->

which we seek to maximize over the discrete planning horizon i = 0 , . . . , N .

Reward Term. The reward function encourages economically favorable grid interactions, where selling electricity to the grid is rewarded and energy purchases are penalized. It is defined as:

<!-- formula-not-decoded -->

where ρ i is the real-time price at step i .

Penalty Term. The penalty function discourages behaviors that lead to accelerated battery degradation and imbalanced utilization across the battery fleet. It consists of two components:

<!-- formula-not-decoded -->

where w 1 and w 2 are user-defined weights.

- Capacity Fade Penalty: This term penalizes cumulative capacity loss, modeled through the increase in the degradation variable c f,k ( t ) :

<!-- formula-not-decoded -->

where Π is the economic cost per unit capacity fade, and c f,swap is the capacity fade of freshly swapped battery.

- Utilization Balance Penalty: Due to the nonlinear aging behavior of lithium-ion batteries, repeatedly using a small subset can lead to disproportionate degradation. To address this, batteries with higher capacity fade are preferentially selected for swapping, encouraging uniform degradation across the entire fleet. We define:

<!-- formula-not-decoded -->

where c f, offset represents a fixed constant used to normalize degradation levels, typically chosen as min k c f,k (0) .

By jointly maximizing economic returns and extending system lifespan, this formulation supports both profitability and sustainability in BSS operations.

## 3.3.3 Discrete-Time Mixed-Integer Optimal Control Problem

The above formulation captures a multiscale optimization problem defined over a finite time horizon. To solve this, we formulate the BSS operation problem as a finite-horizon mixed-integer optimal control problem (MIOCP).

For notational compactness, we first note that the discrete-time system dynamics Equation (3.21) can be interpreted as continuity constraints linking consecutive nodes in the horizon. Specifically, these continuity constraints are written as x i = F i ( x i +1 , u i +1 , b i ) , and the stage cost at each node is denoted as L i = L i ( x i , u i , b i ) , where i = 0 , . . . , N -1 .

This leads to the following finite-horizon MIOCP formulation:

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

other path, state, and control constraints. (3.34)

The decision variables of the optimal control are all discretized states, inputs, and binary decisions:

<!-- formula-not-decoded -->

## 3.4 BSS-MPC

To enable practical and real-time solution of the finite-horizon mixed-integer optimal control problem described above, we adopt a MPC strategy. In our implementation, a prediction horizon of 24 hours (one full day) is selected to fully account for the fluctuations in the day-ahead electricity market as well as the variations in battery swapping demand. Rather than optimizing over the entire scheduling period at once, MPC solves the problem over this moving horizon and updates the solution at each time step, thereby adapting online to changes in system states and external signals.

According to multiple shooting method [44], in each MPC iteration, the finite-horizon optimal control problem is directly transcribed into a MINLP problem, effectively capturing the coupling between discrete decisions and continuous system dynamics within a unified framework.

In practice, the bilinear coupling between binary and continuous variables in Equation (3.21) poses challenges for numerical optimization. To enable tractable formulation, we apply the Big-M

method to obtain an equivalent linear representation:

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

where M is a sufficiently large constant, typically chosen as M = | x max -x min | . These constraints are logically equivalent to the following switching behavior:

<!-- formula-not-decoded -->

## Algorithm: BSS-MPC

Data: Initial grid price ρ , swap demand S , initial state x 0 Result: Control input sequence u and state trajectory x

## Step 1: Kriging Surrogate Fitting ; Sample training state points X from training set X train ; while relative error (RE) ≥ Tol do Add new points X ∗ and update Kriging parameter θ d ; Compute RE on testing set X test , RE ← ∥ y -˜ y ∥ ∥ y ∥ ; end Step 2: MPC Loop ; i ← 0 ; while i &lt; total simulation time do Define prediction horizon as [ i, i + N ] ; Solve surrogate OCP Equations (3.28) to (3.33) over [ i, i + N ] ; Perform feasibility check using SPM Equations (3.2) to (3.13); if solution not feasible then Add new points X ∗ and update Kriging parameter θ d ; continue ; end Apply the first control input u i to the real BSS system; Obtain the resulting state x i +1 ; Update grid price ρ i : i + N and swap demand S i : i + N ; i ← i +1 ; end

By decoupling the state trajectories across intervals and treating integer variables explicitly, the formulation avoids severe nonlinearities and large-scale complexity, enabling the use of state-of-theart MINLP solvers to handle the hybrid nature of the problem more efficiently. The MINLP model is implemented using the JuMP package in the Julia language [45] and solved with the DICOPT

solver [46]. We configured DICOPT to use IPOPT [47] as the NLP solver and CPLEX [48] as the MILP solver.

The BSS-MPC framework, as outlined in Algorithm , comprises two main stages: offline surrogate model construction and online receding-horizon control. In the offline stage, a Kriging surrogate is trained using an initial set of sampled data points and iteratively refined via cross-validation until the prediction error falls below a prescribed tolerance. During the online stage, at each control step, an OCP is formulated over the prediction horizon [ i, i + N ] based on the prevailing electricity price and swapping demand. The solution is subsequently validated against the original model to ensure feasibility. If infeasibility is detected, additional data points are adaptively sampled in the vicinity of the current operating point, the surrogate is updated, and the OCP is re-solved. Once a feasible solution is obtained, only the first control action u i is implemented following the receding horizon strategy, the system state is updated through simulation (or in the real environment), and the procedure advances to the next time step.

## 4 Experiment

To simulate a realistic operational scenario, we construct a virtual community with 200 batteries served by a single station. This configuration, with 179 EV drivers and 21 batteries held in reserve at the BSS, mimics a real-world scenario where a single BSS provides service for a neighborhood. The station maintains a constant inventory of 21 batteries, while the remaining batteries are in circulation with vehicle owners. Each battery is uniquely indexed from 1 to 200. Initially, batteries 1 through 21 are stored in the station, and batteries 22 through 200 are assigned to vehicles. The battery model used in the experiments is identical to that in [15]: A123 Systems ANR26650M1 cylindrical cells with LiFePO 4 cathodes are adopted, and all cell-level parameters have been thoroughly identified via extensive voltage/current cycling tests as reported in [37].

Battery swapping demands are handled in a first-in-first-out (FIFO) manner. When a vehicle arrives to swap a battery, it returns its current battery to the station and receives the next available one from the inventory. For example, if three swaps occur at the first time step, batteries 22 to 24 are returned to the station. The station, in turn, releases three batteries (e.g., batteries 4, 7, and 10), which are appended to the end of the vehicle battery queue. As a result, the new sequence of vehicle-held batteries becomes 25 to 200, followed by 4, 7, and 10.

Since battery swapping is a mandatory service, failing to provide a sufficiently charged battery could, in the long term, damage brand reputation and result in customer attrition. Therefore, while successful swapping does not generate direct revenue, failed swaps incur a cost. Specifically, we impose a penalty of $1 for every 10% shortfall in SOC relative to the swapping threshold. As in Section 3.3, when a battery is used by an EV driver, it operates under stable discharge conditions, and thus capacity degradation is assumed negligible.

Moreover, because there is a mismatch between the simplified model used for planning and the high-fidelity DAE simulation used for evaluation, charge and discharge actions may sometimes result in overcharging or overdischarging. To mitigate such risks, protective strategies should be implemented to automatically halt charging or discharging once predefined limits are exceeded, thereby ensuring the system consistently operates within safe conditions.

The known variations in electricity prices and battery swapping demand are shown in Figure 3. It can be observed that swapping demand is generally higher during the daytime, while it decreases

from evening to early morning; meanwhile, the peak electricity prices also occur during daytime working hours.

Figure 3: Temporal heatmaps of swap demand and electricity price: swap demand is concentrated during daytime and minimal overnight. Electricity prices exhibit a diurnal pattern with lateafternoon peaks, occasional spikes, and a mid-year volatility patch.

<!-- image -->

We additionally implement two models to highlight the advantages of our proposed approach in terms of economic efficiency and battery longevity:

Low-Fidelity model : This model simplifies battery-related states to a single variable-the SOC. Charging and discharging efficiencies are treated as constants, and capacity degradation is modeled as being proportional to the square of the power used. Rewards are assigned based on economic profit, while penalties are applied for capacity loss. This formulation reduces the optimal control problem to a mixed-integer quadratic programming (MIQP) problem:

<!-- formula-not-decoded -->

where w is the weight and η ch is the charge and discharge efficiency. To ensure full charging within one discrete time step (1 hour), we set η ch = 1 1 C .

Rule-Based model : This model follows a heuristic strategy for battery dispatch and charging. Considering the nonlinear degradation characteristics of lithium-ion batteries, the strategy always selects the batteries with greater capacity loss for swapping. This helps to balance the overall aging across the community battery fleet, avoiding the accelerated degradation caused by overusing a subset of batteries and thereby extending the average lifespan of the entire system. Additionally, every battery swapped into the station is fully charged within one hour, thereby maintaining all batteries inside the station at full charge. Instead of using maximum-power charging, at each time step i ∈ { 1 , . . . , N -1 } , we solve the following root-finding problem to determine the control policy u i +1 :

<!-- formula-not-decoded -->

Figure 4: Within-horizon scheduling: optimized battery operation (MPC v.s. baselines) with grid price and swap demand

<!-- image -->

where where F ( x i +1 , u i +1 ) is the backward Euler integration of SPM. Notably, we reformulate the original root-finding task as an optimization problem: the objective function is designed to drive the residual of the equation x i -F ( x i +1 , u i +1 ) = 0 towards zero. In addition, unlike the BSS-MPC and low-fidelity strategies, the rule-based strategy merely considers a single time step rather than a full prediction horizon, which makes it the least computationally demanding approach.

The rule-based strategy ignores both capacity degradation and electricity price fluctuations. The low-fidelity method accounts for price variations but relies on a simplified charge-discharge model and penalizes power quadratically to approximate degradation. In contrast, BSS-MPC explicitly incorporates the aging model and surrogate state transitions, while simultaneously optimizing against dynamic electricity prices.

## 4.1 Planning Results: A One-Day Case Study

To ensure generality, we randomly selected a day (24 hours) to evaluate the effectiveness of the BSSMPC planning. Figure 4 presents the one-day optimization results of the BSS-MPC (Ours), LowFidelity, and Rule-Based methods, illustrating how the three approaches respond to fluctuations in electricity prices and swapping demand. As is evident, the Rule-Based method completely ignores price variations and directly charges the battery to ˜ SOC after each swap, resulting in no arbitrage behavior. In contrast, both the BSS-MPC and Low-Fidelity methods not only account for changes in demand but also adjust their charging and discharging strategies according to price fluctuations. During the first six hours, when both electricity prices and demand are low, the two methods choose to accumulate energy. This allows them to sell a certain amount of electricity for arbitrage during hours 7 and 8, when both prices and demand suddenly increase. At hour 9, there is a brief price dip, during which both methods charge significantly to prepare for the upcoming peak in price and demand. In particular, at hour 10, when the electricity price reaches its highest point, BSS-MPC is still able to sell some electricity. From hour 11 onward, as swapping demand remains consistently high, the arbitrage opportunities shrink, and the decisions made by the three methods become similar. Since the price and demand peaks occur simultaneously, the optimal strategy is clear: the optimizer takes advantage of low-price, low-demand periods to gain small profits while purchasing enough electricity in advance to keep the battery at a high state of charge. This way, during peak periods, only a small amount of electricity needs to be purchased to meet the swapping demand, significantly

reducing overall costs.

Figure 5: Plan vs. Realization (rolling horizon): charging power, swap decisions, and SOC over a day.

<!-- image -->

Additionally, we compared the results of the initial planning phase with those from the rolling optimization that covers the entire 24-hour period. Given that the battery swap station maintains 21 battery slots, displaying the results for all slots would be unclear. Therefore, we randomly selected one slot for analysis, as shown in Figure 5. Figure 5a illustrates the charge and discharge input of the selected battery slot, while Figure 5b shows whether the battery from the selected slot is swapped out (with 1 indicating a swap). Figure 5c displays the evolution of the battery SOC in the selected slot, where the dashed lines indicate that the battery is swapped out, marking a state jump within the battery slot due to the swap.

It is evident that, in the initial hours (e.g., up to hour 10), the decisions made by the rolling optimization are quite similar to those from the initial planning phase. The battery selection decisions for this particular slot remain identical, and both the charge and discharge decisions follow similar

trends with only minor adjustments. As a result, the SOC evolution for this slot also follows a similar path, as the underlying control decisions are aligned. This is because, within the sliding window, the optimizer faces a prediction horizon that has shifted slightly but not significantly, and the difference between the high-precision Kriging surrogate model used in the optimization and the SPM model used by the simulator leads to only small control errors. The small discrepancies in control decisions lead to minor deviations in the SOC profile, but overall, the battery's state remains largely consistent.

However, after hour 10, the decisions made by the rolling optimization gradually begin to diverge more significantly from the initial planning. In some cases, entirely different decisions are made. For example, while the initial plan chooses to discharge the battery and not swap it at hour 11, the rolling optimization opts to charge the battery and perform the swap. This divergence leads to a noticeable shift in the SOC evolution. As the optimization moves further into the sliding window, the decisions regarding charging and swapping become increasingly different, resulting in a distinctly different trajectory for the SOC. This divergence occurs because, as the sliding window progresses further, the optimization problem becomes increasingly different from the original one. The new optimization problems must account for conditions outside the planned horizon, and the cumulative error from the Kriging surrogate model also starts to have a noticeable impact. This highlights how small changes in the optimization decisions can lead to significantly different battery behavior and SOC evolution over time.

In summary, BSS-MPC effectively responds to fluctuations in electricity prices and demand within the prediction horizon when solving the optimization problem. It accumulates a certain amount of electricity during low-price and low-demand periods, minimizing purchases during peak periods to save costs. Additionally, the system identifies opportunities for arbitrage by selling electricity during certain periods. Meanwhile, the rolling optimization process continuously updates the decision-making window, allowing for the adaptation of decisions as the considered prediction horizon changes. This approach also mitigates the cumulative errors at the end of the horizon caused by the Kriging surrogate model in one-time decision-making.

## 4.2 AHalf-Year Comparison of Three Methods

To further compare the performance and characteristics of the three strategies, we evaluated their behavior over a 180-day simulation period under identical initial conditions.

## 4.2.1 Profit and Capacity Fade Comparison

The cumulative profit, average capacity degradation, and variance of c f for the three strategies are summarized in Figure 6.

The rule-based strategy exhibits the weakest overall performance. While selecting the battery with the largest c f yields the most uniform degradation, it completely ignores electricity prices and arbitrage opportunities. Instead, it blindly charges incoming batteries to full capacity within one hour, regardless of market conditions. This leads to continuous energy purchases without revenue and accelerates degradation due to aggressive charging. As a result, it incurs only costs-yielding the lowest profit-and suffers the highest average c f .

Compared with the rule-based strategy, the low-fidelity model achieves a similar total profit while reducing the average degradation cost c f by approximately 17% . This improvement mainly stems from grid-aware scheduling and the implicit power penalty, which captures the positive correlation

Figure 6: 180-Day Cumulative Profit and Capacity Fade Comparison Among Strategies.

<!-- image -->

between battery aging and charging/discharging power. By explicitly regularizing the power, the model encourages slower charging and discharging, thereby mitigating degradation.

In addition, the low-fidelity model employs a simplified battery energy evolution model, which allows it to effectively account for variations in electricity prices and swapping demands. As a result, the model can reduce the rate of battery degradation without incurring significant additional charging or discharging costs.

However, the variance of the degradation cost, is noticeably larger under the low-fidelity model, indicating uneven degradation across the battery fleet. This unevenness originates from the simplified dynamic model's inability to account for the spatial distribution of capacity fade. Although the model captures high-level trade-offs between arbitrage and battery aging, it lacks the fine-grained control necessary to ensure uniform degradation among all batteries.

The BSS-MPC strategy demonstrates the highest flexibility and overall performance, evaluated under two configurations:

- Under the high-profit setting ( w 1 = 10 2 , w 2 = 10 3 ), it achieves the highest total profit (24% improvement over rule-based), while also reducing average c f by 16%.
- The lowc f setting ( w 1 = 10 3 , w 2 = 5 × 10 2 ) yields the lowest average capacity fade (30% improvement), with profit nearly matching that of the low-fidelity model (14% improvement over rule-based).

Both versions demonstrate significant advantages in terms of profit and battery degradation compared with the rule-based and low-fidelity models. By employing a Kriging surrogate to approximate the high-fidelity battery model, the evolution of battery energy and capacity is accurately captured. This enables the BSS-MPC to precisely exploit arbitrage opportunities arising from variations in electricity prices and swapping demands. Meanwhile, the rate of battery aging is explicitly controlled, allowing the system to dynamically adjust parameters as needed to effectively balance short-term profit and long-term battery degradation.

In addition, by explicitly penalizing degradation distribution via Equation (3.27), BSS-MPC results in a c f variance approximately twice that of the rule-based strategy-still indicating reasonably balanced battery usage. Unlike the low-fidelity model, which passively balances profit and degradation through fixed model terms and exhibits significantly higher variance, BSS-MPC enables

tunable control over the trade-off between economic gain and battery longevity. This adaptability allows BSS-MPC to either prioritize revenue or mitigate degradation, depending on application needs-achieving both lower average c f and more balanced degradation across the battery fleet.

Figure 7: Daily SOC-constraint violations across control strategies.

<!-- image -->

## 4.2.2 SOC Constraint Satisfaction

All strategies incorporate a small tolerance ε to accommodate model approximation and discretization errors. We recorded the average state-of-charge (SOC) constraint satisfaction over the 180-day period, measured by the number of batteries selected for swapping despite violating the SOC threshold (see Figure 7), where the threshold is set to ˜ SOC = 0 . 7 .

The low-fidelity model exhibits the poorest compliance. Even with a loose tolerance of ε = 0 . 1 -twoorders of magnitude larger than the others-it still results in frequent violations, with about 40% of selected batteries falling below the threshold. Its oversimplified charge/discharge dynamics lead to SOC drifting both above 0.75 and below 0.7 (e.g., down to 0.65), making it difficult to eliminate violations solely by tuning ε .

In contrast, BSS-MPC uses a Kriging surrogate to accurately fit the true one-hour state transition. Since it directly models transitions at the hourly resolution, it avoids discretization errors altogether and only requires the relative fitting error to be sufficiently small. Despite using a much tighter tolerance ( ε = 0 . 001 ), it satisfies all SOC constraints. The final SOC values are tightly clustered near the threshold, comparable to those produced by the high-fidelity model used in the dummy strategy. This highlights the high modeling accuracy of the Kriging-based dynamics, matching the reliability

of rule-based control while enabling full optimization flexibility.

## 4.2.3 Analysis of Cost Breakdown

Figure 8: Cost breakdown of different control strategies

<!-- image -->

Figure Figure 8 shows the cost breakdown of the three strategies. The total cost consists of three parts: (i) electricity cost (ii) depreciation cost due to battery aging, and (iii) penalties incurred when selected batteries do not meet the required SOC threshold.

Consistent with the observations in the previous sections, the high-profit version of BSS-MPC exhibits the greatest advantage in terms of charging and discharging costs. Although its battery degradation cost is slightly higher than that of the lowc f version, the charging and discharging costs dominate, resulting in the lowest total cost. The lowc f version, on the other hand, achieves the lowest aging depreciation cost while still maintaining a significant advantage in charging and discharging costs compared with the rule-based and low-fidelity models.

Furthermore, both the BSS-MPC and the rule-based strategies strictly satisfy the SOC constraints, resulting in zero swapping penalties. In contrast, penalties account for a substantial portion of the total cost for the low-fidelity model. Although its charging and discharging costs are approximately 14% lower than those of the rule-based strategy, frequent SOC violations incur significant penalties, which offset these gains and eliminate any cost advantage.

In practical battery swapping station operations, the penalties associated with selecting batteries below the required SOC are likely to be far more severe than the simplified assumptions used in our experiments. Such violations can have long-term implications for the station's reputation and operational sustainability, which are beyond the scope of this work to quantify.

Table 2: Comparison of three strategies across four key metrics.

| Strategy              |   Normalized Loss (%) |   Avg c f (%) |   c f Variance (%) |   SOC Satisfaction (%) |
|-----------------------|-----------------------|---------------|--------------------|------------------------|
| Rule-Based            |                100    |        100    |             100    |                    100 |
| Low-Fidelity          |                 98.6  |         82.79 |            1160.7  |                     60 |
| BSS-MPC (high-profit) |                 76.04 |         79.92 |             176.14 |                    100 |
| BSS-MPC (low-cf)      |                 85.29 |         70.05 |             212.63 |                    100 |

## 4.2.4 Overall Comparison

To summarize, Table 2 compares the three strategies across four key metrics: cumulative profit, average c f , c f variance, and SOC compliance. All values are normalized to the rule-based strategy (set as 100%) for intuitive comparison, with the best performance in each metric highlighted in bold. Since all absolute profit values are negative (indicating losses), we present Normalized Loss instead of profit, defined relative to the rule-based strategy. Here, a lower Normalized Loss percentage indicates better economic performance (i.e., smaller cumulative losses).

As shown in Table 2, BSS-MPC consistently excels across all four evaluation metrics, demonstrating its balanced and adaptable design.

- Economic performance : Under the high-profit configuration, BSS-MPC results in the least financial loss (76.04% normalized profit) , outperforming both the low-fidelity model and rulebased baseline. Even in the lowc f setting, it maintains relatively low loss (85.29%), striking an effective trade-off between revenue and degradation.
- Degradation control : BSS-MPC significantly reduces average capacity fade , with the lowc f configuration achieving the lowest c f (70.05%) . This indicates a notable improvement in battery longevity . Furthermore, both BSS-MPC variants maintain much lower c f variance compared to the low-fidelity model (e.g., 176.14% vs. 1160.7%), implying more uniform battery usage across the fleet and fewer aging outliers.
- SOCconstraint satisfaction : Thanks to Kriging-based modeling that directly fits one-hour transitions without discretization error, BSS-MPC enforces strict SOC compliance (100%) even under tight tolerance ε = 0 . 001 . This accuracy matches the rule-based strategy while retaining full optimization flexibility-a capability the low-fidelity model lacks.

In contrast, the low-fidelity model , while incurring slightly less loss than the rule-based baseline, suffers from high c f variance and low SOC compliance , indicating inefficient battery utilization and potential stability concerns in operation. The rule-based strategy , although fully compliant and uniform in battery usage by design, is overly conservative , leading to the highest financial loss .

In summary, BSS-MPC achieves a rare combination of economic viability, degradation mitigation, and robust constraint enforcement, proving itself the most capable and versatile strategy among the three. All the numerical experiments were conducted using warm-start. Under this setup, each simulation iteration of BSS-MPC takes approximately 20-40 seconds to complete, demonstrating the its capability for near real-time operation.

## 5 Conclusion

This paper presents BSS-MPC , the first real-time MPC framework for BSS that explicitly embeds a physics-informed capacity fade model. By capturing both fast-timescale state-of-charge evolution and slow-timescale degradation dynamics, the framework enables operators to systematically balance short-term energy arbitrage profit with long-term battery lifetime, outperforming conventional rule-based and low-fidelity scheduling approaches. BSS-MPC offers a practical and scalable solution for sustainable EV infrastructure. Future work will focus on further reducing computational complexity by developing faster surrogate models and exploring stochastic MPC to handle uncertainties in electricity prices and swapping demand.

## Acknowledgments

## References

- [1] Dr. ˜ Frank Millard. The benefits of battery swapping. Electric &amp; Hybrid Vehicle Technology International , December 2023. Battery swapping in EVs offers high speed, low cost, and improved longevity compared to DC fast charging.
- [2] NIO. App article 527488 - nio. https://www.nio.cn/app-articles/527488 , 2025. Accessed: 2025-09-10.
- [3] NIO. NIO Power, 2024. Accessed: Oct 3, 2025.
- [4] U.S. Department of Energy. Battery swapping technology for electric vehicles: Technical and economic assessment. Technical report, U.S. Department of Energy, 2022. Accessed: 2025-07-26.
- [5] NIO Inc. Nio hosts power up 2024. https://www.nio.com/news/nio-power-up-2024 , 2024. Accessed: 2025-07-26.
- [6] Gogoro Inc. Gogoro earns frost &amp; sullivan's 2024 global company of the year award. https: //www.gogoro.com/news/frostandsullivan/ , 2024. Accessed: 2025-07-26.
- [7] Financial Times. Venture capital investors place bets on demand for battery swapping. Financial Times , July 2025. Discusses venture-capital interest in EV battery swapping start-ups, highlighting global expansion potential.
- [8] The State Council of the People's Republic of China. New energy vehicle industry development plan (2021-2035). https://www.gov.cn/zhengce/content/2020-11/02/ content\_5556716.htm , 2020. Accessed: 2025-07-26.
- [9] S.Alex Yang and Christopher Tang. The rebirth of EV battery-swapping services and why their time is now. Forbes, London Business School Business Strategy Review , April 2024. Discusses resurgence of battery-swapping, benefits such as lower upfront EV cost via leasing, extended battery life, virtual power-plant grid support, and growing industry interest in fleet/MaaS applications.
- [10] Eric Loveday. Elon musk comments on failed tesla battery swap. InsideEVs , June 2015. Coverage of Elon Musk's remarks at Tesla shareholder meeting on why battery swapping pilot failed-'people don't care about pack swap' due to low demand.

- [11] Weipeng Zhan, Zhenpo Wang, Lei Zhang, Peng Liu, Dingsong Cui, and David G Dorrell. A review of siting, sizing, optimal scheduling, and cost-benefit analysis for battery swapping stations. Energy , 258:124723, 2022.
- [12] Hao Wu. A survey of battery swapping stations for electric vehicles: Operation modes and decision scenarios. IEEE Transactions on Intelligent Transportation Systems , 23(8):10163-10185, 2021.
- [13] Dingsong Cui, Zhenpo Wang, Peng Liu, Shuo Wang, David G Dorrell, Xiaohui Li, and Weipeng Zhan. Operation optimization approaches of electric vehicle battery swapping and charging station: A literature review. Energy , 263:126095, 2023.
- [14] Swapnil R Revankar and Vaiju N Kalkhambkar. Grid integration of battery swapping station: A review. Journal of Energy Storage , 41:102937, 2021.
- [15] Yankai Cao, Seong Beom Lee, Venkat R Subramanian, and Victor M Zavala. Multiscale model predictive control of battery systems for frequency regulation markets using physics-based models. Journal of Process Control , 90:46-55, 2020.
- [16] Shengjie Yang, Jiangang Yao, Tong Kang, and Xiangqian Zhu. Dynamic operation model of the battery swapping station for ev (electric vehicle) in electricity market. Energy , 65:544-549, 2014.
- [17] Mohsen Mahoor, Zohreh S Hosseini, Amin Khodaei, and Daniel Kushner. Electric vehicle battery swapping station. arXiv preprint arXiv:1710.06895 , 2017.
- [18] Hao Wu, Grantham Kwok Hung Pang, King Lun Choy, and Hoi Yan Lam. An optimization model for electric vehicle battery charging at a battery swapping station. IEEE Transactions on Vehicular Technology , 67(2):881-895, 2018.
- [19] Yu Zheng, Zhao Yang Dong, Yan Xu, Ke Meng, Jun Hua Zhao, and Jing Qiu. Electric vehicle battery charging/swap stations in distribution systems: Comparison study and optimal planning. IEEE Transactions on Power Systems , 29(1):221-229, 2014.
- [20] Tony Hao Wu, Grantham K. H. Pang, K.L. Choy, and H.Y. Lam. An optimization model for a battery swapping station in hong kong. In 2015 IEEE Transportation Electrification Conference and Expo (ITEC) , pages 1-6, 2015.
- [21] Hao Wu, Grantham Kwok-Hung Pang, King Lun Choy, and Hoi Yan Lam. A charging-scheme decision model for electric vehicle battery swapping station using varied population evolutionary algorithms. Applied Soft Computing , 61:905-920, 2017.
- [22] Mushfiqur R Sarker, Hrvoje Pandži´ c, and Miguel A Ortega-Vazquez. Electric vehicle battery swapping station: Business case and optimization model. In 2013 International Conference on Connected Vehicles and Expo (ICCVE) , pages 289-294. IEEE, 2013.
- [23] Mushfiqur Sarker, Hrvoje Pandzic, and Miguel Ortega-Vazquez. Optimal operation and services scheduling for an electric vehicle battery swapping station. In 2015 IEEE Power &amp; Energy Society General Meeting , pages 1-1, 2015.
- [24] William Infante, Jin Ma, Xiaoqing Han, and Ariel Liebman. Optimal recourse strategy for battery swapping stations considering electric vehicle uncertainty. IEEE Transactions on Intelligent Transportation Systems , 21(4):1369-1379, 2019.

- [25] Xinjiang Chen, Yu Yang, Zongxian Wang, Jie Song, Jianxiao Wang, and Guannan He. Battery swapping station management with heterogeneous battery functionality degradation. IEEE Transactions on Smart Grid , 16(1):478-490, 2025.
- [26] Furkan Ahmad, Mohammad Saad Alam, and Samir M Shariff. A cost-efficient energy management system for battery swapping station. IEEE Systems Journal , 13(4):4355-4364, 2019.
- [27] Chuantao Wu, Xiangning Lin, Quan Sui, Zhixun Wang, Zhongnan Feng, and Zhengtian Li. Twostage self-scheduling of battery swapping station in day-ahead energy and frequency regulation markets. Applied Energy , 283:116285, 2021.
- [28] Saeid Esmaeili, Amjad Anvari-Moghaddam, and Shahram Jadid. Optimal operation scheduling of a microgrid incorporating battery swapping stations. IEEE Transactions on Power Systems , 34(6):5063-5072, 2019.
- [29] Karlo Šepetanc and Hrvoje Pandži´ c. A cluster-based operation model of aggregated battery swapping stations. IEEE transactions on power systems , 35(1):249-260, 2019.
- [30] Yongxin Su, Shuaixian Yue, Lei Qiu, Jie Chen, Rui Wang, and Mao Tan. Energy management for scalable battery swapping stations: A deep reinforcement learning and mathematical optimization cascade approach. Applied Energy , 365:123212, 2024.
- [31] Ahmed A Shalaby, Hussein Abdeltawab, and Yasser Abdel-Rady I Mohamed. Model-free dynamic operations management for ev battery swapping stations: A deep reinforcement learning approach. IEEE Transactions on Intelligent Transportation Systems , 24(8):8371-8385, 2023.
- [32] Farnaz Sohrabi, Mohammad Rohaninejad, Július Bemš, and Zdenˇ ek Hanzálek. Electrification of transportation: A hybrid benders/sddp algorithm for optimal charging station trading. International Journal of Hydrogen Energy , 89:1060-1074, 2024.
- [33] Jorn M. Reniers, Grietus Mulder, Sina Ober-Blöbaum, and David A. Howey. Improving optimal control of grid-connected lithium-ion batteries through more accurate battery and degradation modelling. Journal of Power Sources , 379:91-102, 2018.
- [34] H. E. Perez, X. Hu, and S. J. Moura. Optimal charging of batteries via a single particle model with electrolyte and thermal dynamics. In 2016 American Control Conference (ACC) , pages 4000-4005, 2016.
- [35] PJM. Markets and operations, 2024. Accessed: 2024-07-24.
- [36] Shriram Santhanagopalan, Qingzhi Guo, Premanand Ramadass, and Ralph E White. Review of models for predicting the cycling performance of lithium ion batteries. Journal of power sources , 156(2):620-628, 2006.
- [37] J. C. Forman, S. J. Moura, J. L. Stein, and H. K. Fathy. Genetic identification and fisher identifiability analysis of the doyle-fuller-newman model from experimental cycling of a lifepo4 cell. Journal of Power Sources , 210:263-275, 2012.
- [38] Donald R Jones, Matthias Schonlau, and William J Welch. Efficient global optimization of expensive black-box functions. Journal of Global optimization , 13(4):455-492, 1998.

- [39] Jerome Sacks, William J Welch, Toby J Mitchell, and Henry P Wynn. Design and analysis of computer experiments. Statistical science , 4(4):409-423, 1989.
- [40] Zhaojia Lin, Jingyao Wang, Vladimiros Nikolakis, and Marianthi Ierapetritou. Process flowsheet optimization of chemicals production from biomass derived glucose solutions. Computers &amp; Chemical Engineering , 102:258-267, 2017.
- [41] Christopher Rackauckas and Qing Nie. Differentialequations. jl-a performant and feature-rich ecosystem for solving differential equations in julia. Journal of Open Research Software , 5(1), 2017.
- [42] David J Gardner, Daniel R Reynolds, Carol S Woodward, and Cody J Balos. Enabling new flexibility in the SUNDIALS suite of nonlinear and differential/algebraic equation solvers. ACM Transactions on Mathematical Software (TOMS) , 2022.
- [43] Alan C Hindmarsh, Peter N Brown, Keith E Grant, Steven L Lee, Radu Serban, Dan E Shumaker, and Carol S Woodward. SUNDIALS: Suite of nonlinear and differential/algebraic equation solvers. ACMTransactions on Mathematical Software (TOMS) , 31(3):363-396, 2005.
- [44] Hans Georg Bock and Karl-Josef Plitt. A multiple shooting algorithm for direct solution of optimal control problems. IFAC Proceedings Volumes , 17(2):1603-1608, 1984.
- [45] Miles Lubin, Oscar Dowson, Joaquim Dias Garcia, Joey Huchette, Benoît Legat, and Juan Pablo Vielma. JuMP 1.0: Recent improvements to a modeling language for mathematical optimization. Mathematical Programming Computation , 15:581-589, 2023.
- [46] Ignacio E Grossmann, Jagadisan Viswanathan, Aldo Vecchietti, Ramesh Raman, Erwin Kalvelagen, et al. Gams/dicopt: A discrete continuous optimization package. GAMS Corporation Inc , 37:55, 2002.
- [47] Andreas Wächter and Lorenz T Biegler. On the implementation of an interior-point filter linesearch algorithm for large-scale nonlinear programming. Mathematical programming , 106(1):2557, 2006.
- [48] CPLEX User's Manual. IBM ilog cplex optimization studio. Version , 12(1987-2018):1, 1987.