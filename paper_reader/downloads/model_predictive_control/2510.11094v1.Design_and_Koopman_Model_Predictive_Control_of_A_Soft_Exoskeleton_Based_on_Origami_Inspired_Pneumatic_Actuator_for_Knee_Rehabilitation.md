## Design and Koopman Model Predictive Control of A Soft Exoskeleton Based on Origami-Inspired Pneumatic Actuator for Knee Rehabilitation

Junxiang Wang, Han Zhang, Zehao Wang, Huaiyuan Chen, Pu Wang, Weidong Chen

Abstract -Effective rehabilitation methods are essential for the recovery of lower limb dysfunction caused by stroke. Nowadays, robotic exoskeletons have shown great potentials in rehabilitation. Nevertheless, traditional rigid exoskeletons are usually heavy and need a lot of work to help the patients to put them on. Moreover, it also requires extra compliance control to guarantee the safety. In contrast, soft exoskeletons are easy and comfortable to wear and have intrinsic compliance, but their complex nonlinear humanrobot interaction dynamics would pose significant challenges for control. In this work, based on the pneumatic actuators inspired by origami, we design a rehabilitation exoskeleton for knee that is easy and comfortable to wear. To guarantee the control performance and enable a nice human-robot interaction, we first use Deep Koopman Network to model the human-robot interaction dynamics. In particular, by viewing the electromyography (EMG) signals and the duty cycle of the PWM wave that controls the pneumatic robot's valves and pump as the inputs, the linear Koopman model accurately captures the complex human-robot interaction dynamics. Next, based on the obtained Koopman model, we further use Model Predictive Control (MPC) to control the soft robot and help the user to do rehabilitation training in real-time. The goal of the rehabilitation training is to track a given reference signal shown on the screen. Experiments show that by integrating the EMG signals into the Koopman model, we have improved the model accuracy to great extent. In addition, a personalized Koopman model trained from the individual's own data performs better than the non-personalized model. Consequently, our control framework outperforms the traditional PID control in both passive and active training modes. Hence the proposed method provides a new control framework for soft rehabilitation robots.

Note to PractitionersThis work is motivated from the practical need of offering an easy-to-wear knee rehabilitation training exoskeleton device for patients. In particular, this paper designs a soft exoskeleton based on origami-inspired pneumatic actuator and focus on the fundamental 'tracking scenario' in rehabilitation training. Notably, when attached to the human body, the soft exoskeleton together with the human lower-limb shall form a human-robot coupled system, which is difficult to model; nor to mention that modeling the soft exoskeleton alone is already a difficult task due to its soft intrinsics. To address

This work involved human subjects or animals in its research. Approval of all ethical and experimental procedures and protocols was granted by the Medical Ethics Committee of the Seventh Affiliated Hospital of Sun Yat-sen University under Approval No.SHSYSU202501103240110.

Junxiang Wang, Han Zhang, Zehao Wang, Huaiyuan Chen, Weidong Chen are with School of Automation and Intelligent Sensing, Institute of Medical Robotics, Shanghai Jiao Tong University, and Key Laboratory of System Control and Information Processing, Ministry of Education of China, Shanghai 200240, China. Pu Wang is with the Seventh Affiliated Hospital, SunYat-sen University, Shenzhen 510275, China. Han Zhang is the corresponding author (email: zhanghan tc@sjtu.edu.cn).

this issue, we take both the EMG signals as well as the the duty-cycle of the PWM wave that controls the soft exoskeleton's valves and pump as the inputs, and use data-driven approach to approximate a linear Koopman model that predicts the knee joint angle. Consequently, we are able to achieve well-performed yet computation efficient tracking control on such human-robot coupled soft exoskeleton system.

Index Terms -Knee rehabilitation, Koopman operator, humanrobot system, model predictive control, pneumatic actuators

## I. Introduction

Due to stroke and other neurological disorders, lowerlimb motor dysfunction has become an increasingly serious public health challenge worldwide. It significantly affects the independent living abilities and quality of life of millions of patients. In particular, the knee joints play an important role in lower-limb function by supporting weight, enabling smooth gait transitions and facilitating daily activities such as walking and climbing stairs. Knee joint dysfunction after stroke significantly increases the risk of falls and impedes functional recovery [1, 2]. Therefore, developing efficient and personalized rehabilitation methods and equipments to restore the motor function and improve the quality of life has become a critical task in the field of rehabilitation. To this end, rehabilitation robots have become a promising solution [3, 4]. Owing to their ability to provide high-intensity, repetitive, and quantifiable training, these robot systems are considered to be an effective way to compensate the limitations of traditional rehabilitation resources and improve treatment outcomes [5, 6].

Although traditional rigid exoskeletons have demonstrated significant effectiveness in providing strong support, precise force transmission and fast response [7, 8], they still have intrinsic drawbacks, such as being bulky, heavy, and lacking intrinsic compliance. These drawbacks, particularly the lack of intrinsic compliance, often impair the naturalness and comfort of human-robot interaction [9, 10, 11]. Consequently, this may not only cause the patients to feel uncomfortable when wearing such devices for a long period of time, but also affect their ability to recover normal movement. Moreover, they may also require a lot of assistance from other people to help the patients to wear such a heavy and bulky rigid exoskeleton. These issues may cause the patients to be unwilling to continue using such devices, thereby affecting treatment outcomes.

In contrast, soft exoskeletons have opened up new directions in the field of rehabilitation robotics. This is mainly due to their significant advantages in terms of inherent safety, compliance,

1

lightweight, and enhanced human-machine interaction potential [12, 13, 14]. In recent years, soft actuator technologies such as pneumatic artificial muscles (PAMs) [15], cable-driven systems [16], and other novel pneumatic soft actuators [17] have made significant progress. These advancements have greatly accelerated the research, development, and applications of lower-limb soft exoskeletons. Consequently, the soft exoskeletons offer the patients a more comfortable rehabilitation experience.

However, balancing the high performance with the user comfort remains a challenge in soft exoskeleton design [18]. More specifically, due to their inherent compliance and deformability [19, 20], soft exoskeletons based on pneumatic artificial muscle actuators exhibit complex nonlinear dynamic behaviors. Such behaviors highly depend on material properties, human-machine interaction forces, and individual user characteristics. Hence it is difficult for traditional methods to accurately establish a human-robot interaction system model [21]. And such difficulty has become a major obstacle to the development of real-time control strategies. Moreover, conventional control strategies such as Proportional-IntegralDerivative (PID) and impedance control often exhibit significant limitations on soft rehabilitation robots. More specifically, when dealing with the complex, highly personalized dynamics of human-robot interaction for the soft robots [22], conventional control methods usually require a lot of manual parameter tunings and are usually sensitive to external disturbances. This will lead to the lack of adaptability to different patients which is definitely required to ensure the accuracy and the safety in personalized rehabilitation training. All of these issues limit the clinical translation and practical application of soft exoskeletons.

To address these issues, we adopt Koopman operator theory in this work. As a powerful mathematical framework, it has recently demonstrated great potential in handling complex nonlinear systems [23, 24]. More specifically, it gives a simplified yet precise linear system by lifting the complex nonlinear dynamics into a high-dimensional linear space. Such approach greatly simplifies the analysis and the control of the complex nonlinear systems that are previously difficult to control. Moreover, deep learning-based Koopman methods have been proposed to identify the Koopman operators from data [25, 26]. In particular, it uses deep neural networks to learn an approximated linear representation of the system dynamics in a high-dimensional embedding space. Compared to traditional modeling approaches, such methods are particularly well-suited for soft exoskeletons since we can use data-driven approach to get a precise linear system dynamics and use efficient and well-known control methods for linear systems to control the soft exoskeleton.

In this work, we design a new soft lower-limb rehabilitation exoskeleton based on the origami-inspired pneumatic actuator [27]. Next, we employ a Deep Koopman Network approach to model the dynamics of the human-robot interaction. Moreover, based on the model we have established, we further use Koopman Model Predictive Control (KMPC) to control the soft lower-limb exoskeleton. In particular, the main contribution is three-fold:

- We design and fabricated a soft lower-limb rehabilitation exoskeleton that is lightweight, easy-to-wear and can provide sufficient assistive force to the limb. Such combination is essential for meeting the performance requirements of rehabilitation while ensuring user's comfort, and hence enabling a long-term rehabilitation training.
- ADeep Koopman Network approach is employed to effectively capture the complex interactive dynamics between soft exoskeletons and the human body. By viewing the electromyography (EMG) signals and the duty cycle of the PWMwave that controls the pneumatic robot's valves and pump as the inputs, the linear Koopman model accurately captures the complex human-robot interaction dynamics.
- The EMG signal is used as the feedforward in the MPC control for the soft lower-limb exoskeleton during the rehabilitation training. Experiments shows that the proposed modeling and control framework outperforms conventional control methods.

The remainder of this paper is organized as follows. In Sec. II, we describe the design of our soft lower-limb exoskeleton. In Sec. III, we introduce how we build a human-robot interaction model with the deep Koopman operator and the KMPC framework. Sec. IV presents the experimental results. The implications are also discussed therein. Finally, we conclude the paper and outlines future research directions in Sec. V.

## II. The Hardware Design

In the following, we will explain the design of our lowerlimb exoskeleton system in detail. In particular, we modify and integrate the origami-inspired pneumatic actuator into the exoskeleton system. Moreover, we also add inertial measurement units (IMUs) and electromyography (EMG) sensors for monitoring the knee joint angles and major muscles in realtime so as to design its corresponding pneumatic control system architecture.

## A. The Pneumatic Actuator Design and Fabrication

This system employs an origami-inspired pneumatic actuator based on [27]. The actuator module embeds a QuadrangularExpanded origami frame made of PVC sheet within a flexible air bladder. This soft-rigid integration approach achieves a high contraction ratio. As illustrated in Fig. 1, this actuator achieves bi-directional deformation, i.e., expanding under positive pressure for extension force and contracting under negative pressure for flexion force. Such property closely matches the flexion and extension movements of the human knee joint.

Moreover, the PVC origami skeleton geometrically constrains the air bladder's deformation path. This significantly enhances its stability during negative pressure and transforms its deformation from traditional non-linear bulging to nearly linear folding and unfolding. Furthermore, to meet the needs for lowerlimb rehabilitation training, we optimized the main geometric parameters based on the actuator's size and anatomical fit with the lower-limb. The final lightweight design weighs 0.7 kg, provides the output torque of 17 Nm at 30kPa/20 ° , and offers a movable range from 10 to 350 degrees. The manufacturing process involves several steps: first, laser-cutting 0.3 mm PVC

Fig. 1: The origami-inspired pneumatic actuator showing its contraction under negative pressure and expansion under positive pressure.

<!-- image -->

under Negative Pressure under Positive Pressure

sheets to create creases and ventilation holes; next, attaching the cut PVC film to the inner side of the TPU composite fabric; then, heat-sealing the periphery to form a single air pouch; finally, connecting all air pouches in series and installing bidirectional air pipe interfaces. This process ensures both flexible comfort and sufficient structural rigidity.

## B. The Exoskeleton System Integration and the Structural Design

A direct contact between the soft pneumatic actuator and the leg will cause uneven force transmission and result in adverse reaction forces and unfavorable pneumatic actuator deformations. To address this issue, two 3D-printed connectors (shown in Fig. 2(d)) are attached to both ends of the actuator. Fabricated from high-strength plastic via 3D printing, these connectors provide sufficient structural stiffness and enable the actuator's force to be distributed more evenly across the thigh and lower-leg. On the other hand, the range of motion required for knee rehabilitation training in seated position is approximately 80 to 160 degrees. Nevertheless, as shown in Fig. 3, due to the physical properties of the pneumatic actuator, the torque-pressure coefficient decreases dramatically when the angle is large, which is not sufficient for torque requirements in knee rehabilitation. To avoid letting our pneumatic actuator work in this unfavorable interval, we let the angle for the connector that touches the lower-leg be 60 degrees. The rationale behind such design is that the optimal operating range for our actuator is 20 to 100 degrees. Within this range, the actuator exhibits a high torque-pressure coefficient and provides sufficient rehabilitation torque. Thus such design shall achieve an effective operating range of approximately 80 to 160 degrees for the knee, which is sufficient for knee rehabilitation training scenarios. In addition, the other connector is designed as a curved surface to ensure optimal anatomical adaptation to the thigh. Moreover, to securely attach the connectors to the user's thigh and lower-leg, we use a primary fixing strap as shown

<!-- image -->

(e)  The Patella-Opening Strap

Fig. 2: The overall exoskeleton design and its main Components. (a) The overall view of the assembled exoskeleton mounted on a dummy leg. (b) The pneumatic actuator. (c) The primary fixing strap. (d) The 3D-printed connector. (e) The patella-opening strap.

(d) The 3D-printed connector

<!-- image -->

5.50

Fig. 3: (a) The parameterization of the origami-inspired actuator and volume V is divided into four sub-volumes 𝑣 1 , 𝑣 2 , 𝑣 3 , 𝑣 4 [27].(b) The torque coefficient ( 𝜏 /p) as a function of the total actuator angle 𝜃 with 16 air pouches, calculated using parameters 𝑙 1 = 101 mm, 𝑙 2 = 70 mm, and 𝑙 3 = 20 mm.

in Fig. 2(c). This fastening method can be quickly and flexibly adjusted to fit different users' leg sizes and prevents the actuator from slipping. Besides, we connect a patella-opening strap (Fig. 2(d)) to the knee cap and the patella-opening strap is further connected to the'ears' of the actuator on both sides with strings. In particular, the'ears' of the actuator are enhanced by the 3D printed orange components as shown in Fig. 2(b). Such design prevent any potential actuator center drift from the knee joint and achieves a better force transmission.

## C. The Sensors

As illustrated in Figure 4, we use Inertial Measurement Units (IMUs) to measure the knee joint angle 𝑥 𝑘 . In particular, two IMUs are attached to the thigh and the lower-leg and they can provide a knee joint angle feedback at a frequency of 100 Hz.

Onthe other hand, since the rectus femoris and biceps femoris are the primary muscles that are involved in knee extension and

Fig. 4: Placement of EMG and IMU sensors on the lower limb. EMGsensors are placed on the thigh muscles, and IMU sensors are placed on the thigh and shank to monitor joint angles.

<!-- image -->

flexion, we use two EMG sensors attached to these two muscles and record the EMG signals. In particular, the raw EMG data has a sampling rate of 2000 Hz and it is contaminated a lot by noise. To prevent the noise from affecting the Koopman model identification, each raw EMG signal would go though the following two pre-processing steps:

- Band-pass filtering that uses a 2 nd -order Butterworth filter with 20 Hz and 450 Hz cut-off frequencies;
- RMS calculation over 20-sample windows to downsample the signal to 100 Hz. It is defined as

<!-- formula-not-decoded -->

where 𝑘 = 1 , 2 , . . . indexes consecutive windows and 𝜂 𝑘,𝑖 denotes the 𝑖 -th raw EMG signal sample in the 𝑘 -th window ( 𝑖 = 1 , . . . , 20).

Consequently, the processed EMG signals shall align with the IMUsampling rate. Our pre-processing steps effectively remove noise while preserving the amplitude and temporal characteristics of the muscles activation. Such data pre-processing accords with the steps of electromyographic signal processing [28].

## D. The Pneumatic Control System Architecture

To meet the high power output demand for driving the knee joint, we use a Kamoer KZP20-B24 diaphragm pump to drive the pneumatic actuator. This pump has a rated power of up to 50 W and can provide a maximum pressure of ∓ 80 kPa. To control the direction of airflow, the hardware system integrates a directional control valve. By adjusting the valve state between 'on' and 'off,' the inflation and deflation circuits of the hardware system can be flexibly switched. This enables the inflation and deflation of the pneumatic actuator and thus driving the patient's knee joint during the rehabilitation trainings.

As shown in Figure 5, the complete pneumatic control system hardware achitecture includes a power supply module which is just a voltage regulator circuit (providing 24V and 5V power to the system), a microcontroller (responsible for receiving commands from the

host computer and outputting control signals), a pump driver module and a valve driver module (driving the diaphragm pump and directional control valve), and a diaphragm pump and the valve components required for the pneumatic actuator. Consequently, the system achieves precise control of the airflow direction by switching the state of the valves and uses PWM modulation to regulate the motor speed of the pump, thereby controlling the air flow rate into the pneumatic actuator. This ensures a stable airflow output, a rapid dynamic response and swift switching between inflation and deflation. Micro-controller Power Regulators 5V

Fig. 5: The hardware architecture of the pneumatic drive and control unit. The diagram illustrates the integration of the PC, the Micro-controller, the power module, the pump and its driver, the valve and its driver. It also shows the control signals and airflow paths.

<!-- image -->

## III. The Control Framework

## A. Data-Driven Koopman Modeling for the Human-Robot Interaction Dynamics

In this work, we consider the following knee rehabilitation training scenarios: we let the patient to sit on a chair and attach the soft exoskeleton to his/her knee. The patient's knee joint angle motion is captured and mapped to a moving pointer shown on the screen. The goal for the patient is to let the pointer track a given reference signal by driving moving his/her knee under the assistance from the soft exoskeleton. Hence the overall control objective is to let this human-robot coupled system to track the reference signal.

Nevertheless, due to the soft material and complex geometric deformation patterns, origami-inspired pneumatic actuators are highly compliant and exhibit significant nonlinear dynamics. Moreover, when integrated into a wearable rehabilitation robot and coupled with the human musculoskeletal system, the human-robot system becomes even more intricate. Traditional modeling approaches that are based on rigid-body dynamics or

Fig. 6: Deep Koopman Operator Network Architecture. The encoder maps the original state 𝑥 𝑘 and control input u 𝑘 into a lifted space governed by linear dynamics. The decoder reconstructs the physical state 𝑥 𝑘 + 1 from the lifted representation.

<!-- image -->

simplified pressure-to-angle mappings can describe the actuator's dynamics to some extent, but such models are complex and insufficient for precise control. In addition, it is even more difficult to accurately obtain a patient's precise musculoskeletal model since the limb's weight, moment of inertia are difficult to measure. This is also because the muscle strength, reaction latency, and joint stiffness varies a lot among the patients. These factors make the precise modeling of the dynamics for humanrobot interaction challenging.

To address this challenge, we adopt a data-driven controloriented modeling approach based on Koopman operator theory. In particular, the Koopman operator framework enables us to approximate the nonlinear dynamics of the human-robot interaction system with a linear model in a higher-dimensional lifted space. This offers several advantages: it allows efficient prediction and control synthesis using well-established linear control techniques, and it also circumvents the need for manually deriving complex physical models.

To this end, we formulate the system in discrete-time and take the sample time Δ 𝑡 = 20ms. Let the state 𝑥 𝑘 ∈ R at the time step 𝑘 be the knee joint angle of the human-robot coupled system. Furthermore, let u 𝑘 = [ 𝑢 ( 1 ) 𝑘 , u ( 2 ) , ⊤ 𝑘 ] ⊤ ∈ R 𝑚 , where 𝑢 ( 1 ) 𝑘 is the PWM duty cycle that controls the pump and the valve, which implicitly determines the robot assistive torque that is applied to the knee joint. In addition, u ( 2 ) 𝑘 ∈ R 𝑚 -1 is the electromyography (EMG) signals vector collected from 𝑚 -1 channels. These EMG signals reflects the muscle contraction and hence implicitly determines the muscle torque that is applied to the knee joint. More specifically, note that the EMG signal is ahead of the actual muscle contraction for about 200ms [29, 30], the EMG signal that actually affects the state 𝑥 𝑘 + 1 should be s 𝑘 -𝛿 , where 𝛿 = 10 and s 𝑘 ∈ R 𝑚 -1 is the EMG signal measured at the time step 𝑘 . Hence, there should be a time shift to the actual EMG signal measured at time step 𝑘 when defining u ( 2 ) 𝑘 . Namely, u ( 2 ) 𝑘 : = s 𝑘 -𝛿 .

Since both 𝑢 ( 1 ) 𝑘 and u ( 2 ) 𝑘 contributes to the evolution of the knee joint angle 𝑥 𝑘 , we regard both of them as the inputs of the human-robot interaction dynamics.

Next, we introduce a lifting function 𝜙 : R → R 𝑑 . It maps the original state into a higher-dimensional latent representation z 𝑘 , namely, z 𝑘 = 𝜙 ( 𝑥 𝑘 ) , where z 𝑘 is referred to as the lifted state. In this work, the function 𝜙 is implemented with a deep encoder neural network, referred as Multi-Layer Perception (MLP) encoder, as shown in Fig. 6. Intuitively, the overall architecture can be seen as an encoder-decoder structure, where the 'decoder' is the C matrix that specifies the lifted linear system's output. More specifically, the lifted space dimension 𝑑 is set to 96 based on empirical observations.

Suppose the state evolution in the lifted space is linear, then the next state z 𝑘 + 1 is given by

<!-- formula-not-decoded -->

where A ∈ R 𝑑 × 𝑑 is state transition matrix, and B ∈ R 𝑑 × 𝑚 maps the control input to the lifted dynamics. The pair ( A , B ) serves as a finite-dimensional approximation of the infinitedimensional Koopman operator, which will be identified using the data. Furthermore, to make the control of the physical angle 𝑥 𝑘 possible, we define a reconstruction matrix C ∈ R 1 × 𝑑 such that the original state 𝑥 𝑘 can be recovered from the lifted state. Namely, 𝑥 𝑘 = Cz 𝑘 . Then the angle control problem turns into a problem of controlling the output of the system (1). More specifically in this work, we choose C = [ 1 0 ] to directly extract the original state 𝑥 𝑘 as the first component of z 𝑘 . Such design choice helps to maintain the physical interpretability, simplifies the state reconstruction and contributes to training stability.

To train the lifting function 𝜙 and the Koopman operator's finite dimensional approximation ( A , B ) , we first employ a vanilla controller to the soft exoskeleton and let the patient wear the soft exoskeleton and track the reference signal (which will be explained in detail in Sec. IV). Consequently, the knee joint angle, EMG signals and the PWM duty cycles are collected and

The Koopman Model Training

Fig. 7: The overall experimental framework.

<!-- image -->

we further form them as a dataset

<!-- formula-not-decoded -->

In particular, the collected data are divided into 𝑀 trajectory batches with time horizon length 𝑁 𝑏 = 16. Next, we define an 𝑁 𝑏 -steps prediction loss function to train the lifting function 𝜙 as well as the approximated Koopman operator ( A , B ) . More specifically, the loss function for training takes the form

<!-- formula-not-decoded -->

where we have slightly abuse the notation and let 𝜙 denote the corresponding parameters of the lifting function 𝜙 here. 𝛾 ∈ [ 0 , 1 ] is the temporal discount factor, and we set it to 0.9 empirically. And ˆ z 𝑘 ( 𝜙, A , B ; 𝑥 𝑖 1 ) is the predicted lifted state at the time step 𝑘 based on the initial state 𝑥 𝑖 1 , which takes the form

<!-- formula-not-decoded -->

The network is optimized using the Adam optimizer [31] along with a Noam learning rate strategy. As illustrated in Fig.6, the lifted state z 𝑘 directly includes the state 𝑥 𝑘 . It guides the optimization away from any degenerate all-zero solution.

## B. The Koopman Model Predictive Control for Rehabilitation Robot

Now that we have obtained the Koopman operator model for the human-robot interaction system. Next, we will use such model and apply KMPC to control the soft exoskeleton.

To proceed, we decompose the system's inputs and rewrite (1) as

<!-- formula-not-decoded -->

where B = [ B 1 , B 2 ] , where B 1 ∈ R 𝑑 × 1 and B 2 ∈ R 𝑑 ×( 𝑚 -1 ) . Recall that the overall control objective is to let this humanrobot coupled system (2) to track the reference signal { 𝑥 𝑟 𝑘 } ∞ 𝑘 = 1 .

We hence pose the KMPC that gives the robot's control signal { 𝑢 ( 1 ) 𝑘 | 𝑘 } ∞ 𝑘 = 1 as

<!-- formula-not-decoded -->

where 𝑞 = 1 is the weight that penalizes tracking error, 𝑟 = 0 . 25 is the weight that penalizes control effort, and 𝑢 min = -1, 𝑢 max = 1. In particular, recall that EMG signals are around 200ms earlier than the actual muscle contraction and u ( 2 ) 𝑘 : = s 𝑘 -𝛿 . Hence for the time horizon length that we use 𝑁 = 10, { u ( 2 ) 𝑘 + 𝑡 : = s 𝑘 + 𝑡 -𝛿 } 𝑁 -1 𝑡 = 0 are known signals at the time step 𝑘 . Such time horizon also balances the control performance with the computation load. Moreover, when actually solving (3) at each time step 𝑘 , the problem is reformulated into a more compact form of convex quadratic programming. This ensures that the control 𝑢 ( 1 ) 𝑘 | 𝑘 at each time step 𝑘 can be solved efficiently within the sample time period 20ms.

Notably, the overall control framework enables personalized control strategies that adapt to individual biomechanics and interaction patterns. This is because all of the personal factors such as limb mass and its moment of inertia, muscle strength, etc., are implicitly modeled into the Koopman model. In particular, we have considered the human and the robot as a whole system and the Koopman model also covers the complex dynamics of the soft exoskeleton. Consequently, we can apply the well-known LQR to control the system efficiently.

## IV. The Experiments

This section presents the experimental validation of the proposed modeling and KMPC framework for the soft exoskeleton. As explained in Sec. III-A, we focus on the knee rehabilitation in a seated scenario. The participants are asked to track a given

Rehabilitation Training

reference signal by moving his/her knee under the assistance from the soft exoskeleton. In particular, the experiment aims to validate the following three aspects:

- 1) The Koopman operator can indeed model human-robot interaction dynamics well, and its predictive accuracy improves when the EMG information is added as the input;
- 2) The ability that the Koopman model captures captures personalized human-robot interaction dynamics, and such dynamics is still valid when tracking different reference signals;
- 3) The capability of soft exoskeletons to provide both passive and active rehabilitation training with our KMPC method and it outperforms conventional PID control.

To this end, we design the overall experimental procedure as illustrated in Fig. 7. In particular, the procedure is divided into three stages: data acquisition, Koopman model training, and rehabilitation training. The experiments are conducted on five healthy participants, whose age varies from 20 to 25 years old, and all of them are males.

In the data acquisition stage, we control the soft exoskeleton with a conventional PID controller to track a given reference trajectory. And each participant performs knee flexion and extension movements in a seated position. The reference trajectory is a sinusoidal motion between 90 and 120 degrees, with a frequency of 0.2 Hz. To potentially exciting the human-robot interaction dynamics persistently, the data is collected under two kinds of rehabilitation trainings:

- Passive Mode: The participant's lower-limb remains relaxed. The knee joint is completely driven by the soft exoskeleton actuation to track the reference signal.
- Active Mode: The participant actively contributes to track the reference signal, and the knee joint is actuated by both soft exoskeleton and the participant's muscle.

Each mode includes 5 groups and we collect the knee joint angles, EMG signals and PWM duty-cycle values. Moreover, we do not distinguish the data collected from the two modes and construct the training dataset as explained in Sec. III-A. In particular, to prevent gradient explosion, the joint angle data is scaled by a factor of 20 and the PWM duty-cycle values are normalized to the range of [-1 , 1 ] . Moreover, to avoid fatigue, the participants are given adequate rest between the groups, and their comfort are monitored throughout the experiment. When the dataset is constructed, we train the Koopman model as explained in Sec. III-A.

Once the participant's personalized Koopman model is trained and the KMPC is set, we start the rehabilitation training stage.

Moreover, we also test the generalizability our control framework by letting the participants to track different reference trajectories.

Furthermore, the tracking performance of our soft exoskeleton are tested in both passive and active rehabilitation trainings. In addition, each rehabilitation training lasts 60 seconds, and the participant's comfort is continuously monitored to prevent excessive fatigue. More specifically, the experimental scenario is shown in Fig. 8 (b), while Fig 8 (a) is the interface we designed for interacting with patients. The results are illustrated in the following sections.

Fig. 8: (a) Interactive Interface. The vertical movement of the flappy bird on the left side of the interface corresponds to the knee joint angle measured by the IMU, while the white line in the center of the interface represents the reference trajectory. (b) The experimental scenario.

<!-- image -->

a

## A. Deep Koopman Model Validation

Since the performance of the KMPC controller depends on the accuracy of the dynamics, we will quantitatively evaluates the prediction accuracy of the trained Koopman model for the human-robot interaction dynamics.

One key contribution of this work is to take the EMG signals as the input of the Koopman model and consider the human-robot interaction dynamics. It shall give a more accurate personalized human-robot interaction dynamics for each individual participants and thus enhancing the control performance.

To verify this, we first construct a test dataset from the collected data. We then compare the predictive performance of the following two models on the test set - one with EMG signal inputs ( u ( 1 ) 𝑘 ) and one without. In Fig. 9a, we illustrate the prediction error that is computed from a trajectory in the test set as an example. Clearly, the model that incorporates the EMG signals demonstrates a lower prediction error across all prediction steps. This result confirms the critical role of EMG signals in accurately capturing the system's dynamics.

Next, we illustrate the accuracy of the Koopman model that incorporates the EMG signals on another test dataset. Fig. 9b presents four examples of knee joint angle prediction. In each subplot, the trajectory predicted from the initial value accord well with the actual knee joint angle in the overall trend as well as the key inflection points over a 16-step prediction horizon. Recall that the Koopman model takes both of the complex dynamics of the soft actuator and the human musculoskeletal dynamics into account. It can be concluded from the predicted trajectories that the Koopman model consistently captures the principal motion patterns well.

Such robust predictive performance provides a reliable and accurate model basis for the subsequent KMPC design.

b

TABLE I: The Root Mean Square Error (RMSE) tracking errors in degrees ( ° ), compared between personalized and nonpersonalized model under different frequencies and angle ranges in passive mode for participants P1 to P5.

|   Ref. Traj. Freq. (Hz) | Ref. Traj. Peak Angle Range ( ◦ )   | Model Used      | P1            | P2            | P3            | P4            | P5            |
|-------------------------|-------------------------------------|-----------------|---------------|---------------|---------------|---------------|---------------|
|                    0.16 | 90-120                              | Pers. Non-Pers. | 2.2933 2.8923 | 1.8421 2.0143 | 2.0262 2.4298 | 0.7189 1.3553 | 1.0640 2.1641 |
|                    0.2  | 90-120                              | Pers. Non-Pers. | 3.2650 3.9000 | 1.5989 2.4224 | 2.2230 2.7117 | 0.9069 1.1039 | 1.2427 2.0770 |
|                    0.25 | 90-120                              | Pers. Non-Pers. | 4.4369 9.4003 | 3.1267 4.1941 | 2.7982 3.1707 | 1.2030 1.9197 | 3.0558 3.1998 |
|                    0.2  | 90-125                              | Pers. Non-Pers. | 5.5482 5.3608 | 2.5690 3.0144 | 3.3543 3.9561 | 1.3098 1.8452 | 2.2640 3.3321 |
|                    0.2  | 90-130                              | Pers. Non-Pers. | 7.1732 7.7117 | 3.6556 3.7474 | 5.6207 6.3152 | 2.2093 2.1582 | 2.1623 4.2665 |

## B. Validation of the Personalized Assistance Strategy

Rehabilitation training is highly personalized due to the fact that everyone's human-robot interaction dynamics is different. Since the Koopman model in our framework is identified through everyone's own personalized data, our framework shall suit different participants well.

To demonstrate this personalization capability, we compare the average tracking error among the five healthy participants (P1-P5). In particular, we evaluate the following two models on each participant in both active and passive rehabilitation trainings:

- Non-personalized model: The model is trained using the data collected from a participant (one of the developer of the soft exoskeleton) that is not P1-P5.
- Personalized model: The model is trained with the participant's own data.

And the reference trajectory is a sinusoidal curve with a frequency of 0.20 Hz and a range of 90 to 120 degrees.

Fig. 10: The average tracking errors of personalized and nonpersonalized human-robot interaction dynamics in both active and passive modes.

<!-- image -->

As illustrated in Fig. 10, the personalized models outperform non-personalized models in all experiments. The performance advantage of personalized models is particularly pronounced in passive rehabilitation trainings. The stars '*' and '**' in the figure indicates the significant differences between the personalized model and the non-personalized model under the same training mode (' ∗ ' indicates 𝑝 &lt; 0 . 05, ' ∗∗ ' indicates 𝑝 &lt; 0 . 01). More specifically, we take the participant P5 as

(a) The prediction-error comparison between Koopman models with and without the EMG input. 114 112 93 92 Predicted True Predicted True Predicted True Predicted True

<!-- image -->

Angle (°)

Angle (°)

2.5 0.0 5.0 7.5 10.012.515.0 2.5 0.0 5.0 7.5 10.012.515.0 Time  steps Time  steps 89 92 (b) The Koopman model's knee joint angle prediction v.s. the actual measured knee joint angle evolution.

<!-- image -->

Fig. 9: The prediction error comparison of the Koopman models and the predicted trajectory illustration.

（ a ） b Fig. 11: The tracking error histograms of KMPC and PID controller for all participants. (a) Tracking error distribution in passive mode. (b) Tracking error distribution in active mode.

<!-- image -->

an example. The tracking error of the KMPC under its nonpersonalized model has an average of approximately 2.1 degrees in passive rehabilitation training, while the personalized model reduced the tracking error to 1.2 degrees. For the participants P2 and P3, we also observe similar statistically significant differences. Consequently, the personalized model effectively reduces the tracking errors in rehabilitation trainings, from approximately 2.4 to 1.6 degrees and from approximately 2.7 to 2.2 degrees, respectively. For the participants P1 and P4, the lack of statistically significant difference between the personalized and non-personalized model might due to the fact that the nonpersonalized Koopman model is already highly suited for the participants, and the gains from the personalized model might be relatively limited. On the other hand, for the active rehabilitation trainings, the performance difference between the two models is smaller. Nevertheless, the KMPC under personalized model still offers lower tracking errors for most participants (P1, P2 and P3). This suggests that our framework adapts to different users and provide a better human-robot interaction performance.

Wefurther evaluate the controller's generalizability to unseen reference trajectories. To this end, we present the results of all participants across different models. In particular, we let the participants conduct the passive rehabilitation training for different reference trajectories under the assistance from KMPC with both personalized and non-personalized humanrobot interaction dynamics. As shown in Tab. I, when the reference signal's frequency varies (0.16 Hz, 0.20 Hz, and 0.25 Hz) and the peak angle range remains the same (90 ◦ -120 ◦ ), the personalized model achieves a lower RMSE. Similarly, when the peak angle range increases (from 90 ◦ -120 ◦ to 90 ◦ -130 ◦ ) and the frequency remains the same (0.2 Hz), the personalized model continues to outperform the non-personalized model in most cases. The results indicate that our personalized model trained on the specific trajectory can robustly generalize its performance to other reference trajectories.

## C. The Performance Comparison Between KMPC and Conventional PID

Finally, we evaluate the control performance of the KMPC on the five participants. In particular, we compare the tracking errors of our control framework with the conventional PID

controller that is used to collect dataset in both passive and active rehabilitation trainings. In addition, the reference trajectory is the sinusoidal curve with a frequency of 0.20 Hz and has a peak range of 90 to 120 degrees.

As shown in Table II, we observe that in passive mode, KMPC exhibits a consistent lower tracking error than PID. In active mode, KMPC generally also reduces the tracking error for most participants except for P5. This is because that the PID parameters are fixed, and the individual differences among the participants lead to a lack of adaptability as mentioned previously. Consequently, this results in larger tracking errors for passive modes especially for P1. In contrast, KMPC technology can overcome this limitation.

TABLE II: Comparison of the RMSE tracking errors in degrees ( ° ) between KMPC and conventional PID under different rehabilitation training modes.

|    |   Passive(KMPC) |   Passive(PID) |   Active(KMPC) |   Active(PID) |
|----|-----------------|----------------|----------------|---------------|
| P1 |          3.265  |         5.6402 |         1.1471 |        1.4103 |
| P2 |          1.5989 |         2.3799 |         1.2026 |        1.3603 |
| P3 |          2.223  |         3.0815 |         1.211  |        1.5883 |
| P4 |          0.9069 |         2.2538 |         1.1032 |        1.7046 |
| P5 |          1.2427 |         2.1305 |         1.7849 |        1.6393 |

In addition, to further compare the tracking error distribution, we pool all the data from P1 to P5 and plott the combined tracking error histogram. As shown in Fig. 11 (a), the KMPC controller demonstrates superior performance to conventional PID. In particular, compared to conventional PID, the tracking errors of KMPC in both passive and active rehabilitation trainings are more concentrated around zero (especially for the passive rehabilitation case). In contrast, the PID controller's error distributes in a wider range, with a significant portion of errors falling between 2 ◦ and 6 ◦ .

## V. Conclusion and Future Work

We present a design and control of a soft exoskeleton based on the origami-inspired pneumatic actuator. The designed soft exoskeleton is light and easy-to-wear and achieves a balance between safety, compliance, user comfort and effective force transmission. We also consider the human and the soft exoskeleton as a whole system. In particular, we collect the participants' knee joint angles, the EMG data and the PWM

duty cycles that control the valve and the pump. The data is then used to build a linear model for the human-robot interaction dynamics based on Deep Koopman Network. Then, KMPC is used to control the soft exoskeleton to provide personalized assistance to the participants in the rehabilitation training. Through the experiments, we have demonstrated that integrating EMG signals into the Koopman model would improve the Koopman model's accuracy. Moreover, our comparative study validates the need of a personalized model: models trained based on the participant's own data outperform non-personalized models for most cases. In particular, the trajectory tracking errors are smaller than the ones that are based on KMPC with non-personalized models. Furthermore, the proposed KMPC framework has a smaller tracking error than conventional PID controller in both passive and active rehabilitation trainings. The proposed framework can adapt to different participants and show the promising potentials to suit different patients in rehabilitation trainings. Our future work will focus on conducting clinical validation of this system for stroke patients to assess its clinical efficacy.

## References

- [1] Hongyao Wang, Haifei Shen, Yi Han, Wenlu Zhou, and Junjie Wang. Effect of robot-assisted training for lower limb rehabilitation on lower limb function in stroke patients: a systematic review and meta-analysis. Frontiers in Human Neuroscience , 19:1549379, 2025.
- [2] Mingxing Lyu, Wei-Hai Chen, Xilun Ding, Jianhua Wang, Zhongcai Pei, and Baochang Zhang. Development of an emgcontrolled knee exoskeleton to assist home rehabilitation in a game context. Frontiers in neurorobotics , 13:67, 2019.
- [3] Alberto Plaza, Mar Hernandez, Gonzalo Puyuelo, Elena Garces, and Elena Garcia. Lower-limb medical and rehabilitation exoskeletons: A review of the current designs. IEEE Reviews in Biomedical Engineering , 16:278-291, 2023.
- [4] Aaron J. Young and Daniel P. Ferris. State of the art and future directions for lower limb robotic exoskeletons. IEEE Transactions on Neural Systems and Rehabilitation Engineering , 25(2):171-182, 2017.
- [5] Tzu-Hao Huang, Sainan Zhang, Shuangyue Yu, Mhairi K. MacLean, Junxi Zhu, Antonio Di Lallo, Chunhai Jiao, Thomas C. Bulea, Minghui Zheng, and Hao Su. Modeling and stiffness-based continuous torque control of lightweight quasidirect-drive knee exoskeletons for versatile walking assistance. IEEE Transactions on Robotics , 38(3):1442-1459, 2022.
- [6] Karla Bustamante Valles, Sandra Montes, Maria de Jesus Madrigal, Adan Burciaga, Mar´ ıa Elena Mart´ ınez, and Michelle J Johnson. Technology-assisted stroke rehabilitation in mexico: a pilot randomized trial comparing traditional therapy to circuit training in a robot/technology-assisted therapy gym. Journal of neuroengineering and rehabilitation , 13(1):83, 2016.
- [7] Lukas Bergmann, Oliver L¨ uck, Daniel Voss, Philipp Buscherm¨ ohle, Lin Liu, Steffen Leonhardt, and Chuong Ngo. Lower limb exoskeleton with compliant actuators: Design, modeling, and human torque estimation. IEEE/ASME Transactions on Mechatronics , 28(2):758-769, 2023.
- [8] Chao-Feng Chen, Zhi-Jiang Du, Long He, Jia-Qi Wang, DongMei Wu, and Wei Dong. Active disturbance rejection with fast terminal sliding mode control for a lower limb exoskeleton in swing phase. IEEE Access , 7:72343-72357, 2019.
- [9] Laurent Levesque, Scott Pardoel, Zlatko Lovrenovic, and Marc Doumit. Experimental comfort assessment of an active exoskeleton interface. In 2017 IEEE International Symposium on Robotics and Intelligent Sensors (IRIS) , pages 38-43, 2017.
- [10] Longbao Chen, Ding Zhou, and Yuquan Leng. A systematic review on rigid exoskeleton robot design for wearing comfort: Joint self-alignment, attachment interface, and structure customization. IEEE Transactions on Neural Systems and Rehabilitation Engineering , 32:3815-3827, 2024.
- [11] Sergei V. Sarkisian, Marshall K. Ishmael, and Tommaso Lenzi. Self-aligning mechanism improves comfort and performance with a powered knee exoskeleton. IEEE Transactions on Neural Systems and Rehabilitation Engineering , 29:629-640, 2021.
- [12] Michele Xiloyannis, Ryan Alicea, Anna-Maria Georgarakis, Florian L. Haufe, Peter Wolf, Lorenzo Masia, and Robert Riener. Soft robotic suits: State of the art, core technologies, and open challenges. IEEE Transactions on Robotics , 38(3):13431362, 2022.
- [13] Carly M. Thalman, Tiffany Hertzell, and Hyunglae Lee. Toward a soft robotic ankle-foot orthosis (sr-afo) exosuit for human locomotion: Preliminary results in late stance plantarflexion assistance. In 2020 3rd IEEE International Conference on Soft Robotics (RoboSoft) , pages 801-807, 2020.
- [14] Matheus S. Xavier, Charbel D. Tawk, Ali Zolfagharian, Joshua Pinskier, David Howard, Taylor Young, Jiewen Lai, Simon M. Harrison, Yuen K. Yong, Mahdi Bodaghi, and Andrew J. Fleming. Soft pneumatic actuators: A review of design, fabrication, modeling, sensing, control and applications. IEEE Access , 10:59442-59485, 2022.
- [15] Yong-Lae Park, Jobim Santos, Kevin G. Galloway, Eugene C. Goldfield, and Robert J. Wood. A soft wearable robotic device for active knee motions using flat pneumatic artificial muscles. In 2014 IEEE International Conference on Robotics and Automation (ICRA) , pages 4805-4810, 2014.
- [16] Bin Zhong, Kaiqi Guo, Haoyong Yu, and Mingming Zhang. Toward gait symmetry enhancement via a cable-driven exoskeleton powered by series elastic actuators. IEEE Robotics and Automation Letters , 7(2):786-793, 2022.
- [17] Jing Fang, Jianping Yuan, Mingming Wang, Liangfeng Xiao, Jiasheng Yang, Zhiqiang Lin, Peixuan Xu, and Linliang Hou. Novel accordion-inspired foldable pneumatic actuators for knee assistive devices. Soft Robotics , 7(1):95 - 108, 2020. Cited by: 60.
- [18] Wei Meng, Chang Zhu, Haojie Liu, Quan Liu, and Sheng Xie. Soft ankle-foot exoskeleton for rehabilitation: A systematic review of actuation, sensing, mechanical design, and control strategy. IEEE Transactions on Medical Robotics and Bionics , 6(2):384-398, 2024.
- [19] Charbel Tawk and Gursel Alici. A review of 3d-printable soft pneumatic actuators and sensors: Research challenges and opportunities. Advanced Intelligent Systems , 3(6):2000223, 2021.
- [20] Lu Shi, Caio Mucchiani, and Konstantinos Karydis. Online modeling and control of soft multi-fingered grippers via koopman operator theory. volume 2022-August, page 1946 - 1952, 2022. Cited by: 10; All Open Access, Green Open Access.
- [21] Zixi Chen, Federico Renda, Alexia Le Gall, Lorenzo Mocellin, Matteo Bernabei, Th´ eo Dangel, Gastone Ciuti, Matteo Cianchetti, and Cesare Stefanini. Data-driven methods applied to soft robot modeling and control: A review. IEEE Transactions on Automation Science and Engineering , 22:2241-2256, 2025.
- [22] Ameer Hamza Khan, Zili Shao, Shuai Li, Qixin Wang, and Nan Guan. Which is the best pid variant for pneumatic soft robots? an experimental study. IEEE/CAA Journal of Automatica Sinica , 7(2):451-460, 2020.
- [23] Milan Korda and Igor Mezi´ c. Linear predictors for nonlinear dynamical systems: Koopman operator meets model predictive control. Automatica , 93:149 - 160, 2018. Cited by: 781; All Open Access, Bronze Open Access, Green Open Access.
- [24] Daniel Bruder, Xun Fu, R. Brent Gillespie, C. David Remy, and Ram Vasudevan. Data-driven control of soft robots using koopman operator theory. IEEE Transactions on Robotics , 37(3):948-961, 2021.

- [25] Enoch Yeung, Soumya Kundu, and Nathan Hodas. Learning deep neural network representations for koopman operators of nonlinear dynamical systems. In 2019 American Control Conference (ACC) , pages 4832-4839, 2019.
- [26] Haojie Shi and Max Q.-H. Meng. Deep koopman operator with control for nonlinear systems. IEEE Robotics and Automation Letters , 7(3):7700-7707, 2022.
- [27] Huaiyuan Chen, Yiyuan Ma, and Weidong Chen. Design and optimization of an origami-inspired foldable pneumatic actuator. IEEE Robotics and Automation Letters , 9(2):1278-1285, 2024.
- [28] Silvia Muceli and Roberto Merletti. Tutorial. frequency analysis of the surface emg signal: Best practices. Journal of Electromyography and Kinesiology , 79:102937, 2024.
- [29] Shanette A. Go, William J. Litchy, Loribeth Q. Evertz, and Kenton R. Kaufman. Evaluating skeletal muscle electromechanical delay with intramuscular pressure. Journal of Biomechanics , 76:181-188, 2018.
- [30] Thomas J. Roberts and Annette M. Gabald´ on. Interpreting muscle function from emg: Lessons learned from direct measurements of muscle force. Integrative and Comparative Biology , 48(2):312 -320, 2008. Cited by: 142; All Open Access, Bronze Open Access, Green Open Access.
- [31] Kingma DP Ba J Adam et al. A method for stochastic optimization. arXiv preprint arXiv:1412.6980 , 1412(6), 2014.