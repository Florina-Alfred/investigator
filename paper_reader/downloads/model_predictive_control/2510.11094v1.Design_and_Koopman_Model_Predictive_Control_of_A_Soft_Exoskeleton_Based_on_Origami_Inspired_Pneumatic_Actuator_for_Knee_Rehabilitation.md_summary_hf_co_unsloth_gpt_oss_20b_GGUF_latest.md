**Title & Citation**  
*Design and Koopman Model Predictive Control of A Soft Exoskeleton Based on Origami‑Inspired Pneumatic Actuator for Knee Rehabilitation* – Junxiang Wang, Han Zhang, Zehao Wang, Huaiyuan Chen, Pu Wang, Weidong Chen (School of Automation and Intelligent Sensing, Institute of Medical Robotics, Shanghai Jiao Tong University, and Seventh Affiliated Hospital, Sun Yat‑sen University, China).  *Open‑access repository and author affiliations provided in the paper.*

---

## Abstract  
An origami‑inspired pneumatic actuator is used to build a lightweight, compliant knee exoskeleton for stroke rehabilitation. Human‑robot interaction dynamics are modeled with a **Deep Koopman Network (DKN)**, where the state is the knee joint angle, and the inputs are the PWM duty cycle of the pump/valve and EMG signals from rectus femoris and biceps femoris (time‑shifted to account for electromechanical delay). The DKN lifts the state to a 96‑dimensional latent space, predicts future angles via a linear Koopman operator \((A,B)\), and reconstructs the angle with \(C=[1\ 0]\).  
The resulting model is used in a **Koopman Model Predictive Control (KMPC)** scheme that tracks a reference trajectory on a screen.  Experiments with five healthy male participants show that incorporating EMG improves prediction accuracy, a personalized model trained on each participant’s data outperforms a non‑personalized model, and the KMPC yields lower tracking errors than a conventional PID controller in both passive and active training modes.

---

## Introduction & Motivation  

- Knee dysfunction after stroke hampers gait and daily activities.  Soft exoskeletons improve comfort and intrinsic compliance, but their nonlinear, patient‑dependent interaction dynamics hinder control.  
- The paper proposes to **model the whole human‑robot coupled system** as a single linear system in a lifted space using the **Koopman operator**.  
- Prior work (e.g., [27]) provides the origami actuator; this work integrates it into a rehabilitative exoskeleton and couples it with data‑driven control.

---

## Methods / Approach  

### A. Hardware Design  

1. **Origami‑inspired pneumatic actuator**  
   *   Quadrangular‑expanded origami frame in PVC, embedded in a TPU bladder.  
   *   Bi‑directional deformation: expansion under positive pressure (extension), contraction under negative pressure (flexion).  
   *   Final mass 0.7 kg; torque ≈ 17 Nm at 30 kPa (20°); operating range 10–350°.  
   *   Manufacturing used laser‑cut PVC (0.3 mm), heat‑sealed with TPU, and connected serially.  
2. **3D‑printed connectors**  
   *   Two high‑strength plastic connectors attach the actuator to thigh (curved surface) and shank (patella‑opening strap), ensuring uniform force transmission and preventing center drift.  
3. **Sensors**  
   *   Two IMU modules (thigh & shank) provide knee joint angle at 100 Hz.  
   *   Two EMG electrodes on rectus femoris & biceps femoris; raw EMG (2000 Hz) → band‑pass (20‑450 Hz) → 20‑sample RMS → 100 Hz.  This preserves muscle activation amplitude while removing noise.
4. **Pneumatic drive**  
   *   Kamoer KZP20‑B24 diaphragm pump (50 W, ±80 kPa) + directional control valve.  
   *   PWM duty cycle (−1 → +1) regulates pump speed; valve switches “on/off” to inject or release air.  

### B. Data‑Driven Koopman Modeling  

- Discrete‑time system (Δt = 20 ms).  
- State: \(x_k\) = knee angle.  
- Inputs: \(u_k=[u^{(1)}_k\; u^{(2)}_k]^T\)  
  *   \(u^{(1)}_k\): PWM duty cycle (affects actuator torque).  
  *   \(u^{(2)}_k\): EMG vector shifted by \(\delta=10\) steps to compensate ≈200 ms electromechanical delay: \(u^{(2)}_k = s_{k-\delta}\).  
- Backbone: A Deep Koopman Network (DKN) with encoder \(\phi:\mathbb{R}\to\mathbb{R}^{96}\) (MLP).  
- Dynamics in lifted space:  
  \[
  z_{k+1}=Az_k+B u_k,\qquad x_k = C z_k,\quad
  C=[1\ 0]
  \]  
  where \(A\in\mathbb{R}^{96\times96}\), \(B\in\mathbb{R}^{96\times m}\).  
- **Training data**: 5 participants performed passive & active sinusoidal knee motions (90–120°, 0.2 Hz). Measured \(x_k,\; u^{(1)}_k,\; u^{(2)}_k\), forming batches \(M\) with horizon \(N_b=16\).  
- **Loss**:  
  \[
  \mathcal{L}=\frac{1}{M} \sum_{j\in J}\sum_{k=1}^{N_b}\gamma^{k-1}
  \|\hat{z}_{k}^{(j)}-z_{k}^{(j)}\|^2,\quad
  \gamma=0.9
  \]  
  where \(\hat{z}_{k}^{(j)}\) predicted via repeated application of \(A,B\).  
- Optimized with Adam + Noam scheduler; hard‑clamping of inputs.

### C. Koopman Model Predictive Control (KMPC)

- Model re‑written:  
  \[
  z_{k+1}=A z_k + B_1 u^{(1)}_{k} + B_2 u^{(2)}_{k}
  \]  
  \(B_1\in\mathbb{R}^{96\times1}\), \(B_2\in\mathbb{R}^{96\times(m-1)}\).  
- Control horizon \(N=10\), weight \(\alpha=1\), effort penalty \(\beta=0.25\).  
- At time k, known future EMG \(u^{(2)}_{k}:{k}\) from \(s_{k:N-1-\delta}\).  
- Quadratic program:  
  \[
  \min_{\{u^{(1)}_{k:N-1}\}} \sum_{i=k}^{k+N-1}\Bigl(\|x_i-x_i^r\|^2 + \beta\,|u^{(1)}_i|^2\Bigr)
  \]  
  subject to \(u_i^{(1)}\in[-1,1]\).  
- Solved in 20 ms using CVXGEN‑style SOCP.

---

## Experiments / Data / Results  

| **Stage** | **Procedure** | **Equipment** | **Notes** |
|-----------|----------------|---------------|-----------|
| 1. Data Acquisition | PID‑controlled tracked sinusoid (90–120°, 0.2 Hz). | 5 participants, passive & active modes | 5 groups per mode. |
| 2. Koopman Training | Build dataset, train personalized & non‑personalized models | Adam/Noam | z‑dimension 96 |
| 3. Rehabilitation Training | KMPC with personalized model on passive and active tasks | Reference variety | 60 s per trial, rest. |

**Key Figures**  
- **Fig. 1** – actuator contraction/expansion (origami).  
- **Fig. 2** – full exoskeleton assembly.  
- **Fig. 3** – torque coefficient vs. actuator angle.  
- **Fig. 4** – sensor placement.  
- **Fig. 5** – pneumatic drive architecture.  
- **Fig. 6** – DKN architecture.  
- **Fig. 7** – experimental procedure flow.  
- **Fig. 8** – interface: flappy bird showing real angle, white line showing reference.  
- **Fig. 9** – (a) prediction error vs. EMG input, (b) 16‑step predictions.  
- **Fig. 10** – personalized vs non‑personalized RMSE matrix.  
- **Fig. 11** – error histograms for KMPC vs PID.

**Tables**  
- **Table I (RMSE)** – mean ± std. for personalized/non‑personalized across frequency (0.16, 0.20, 0.25 Hz) and angle ranges (90–120°; 90–130°). Shows systematic 1–2 ° improvement.  
- **Table II (KMPC vs PID)** – shows RMSE in passive and active modes for each participant; KMPC dominates.

**Experimental Findings**  

1. **EMG inclusion**: models with EMG exhibit 20–30 % lower prediction error across horizons (Fig. 9a).  
2. **Personalization**: Personalized models outperform non‑personalized models in 4 of 5 participants; largest gains in passive mode (Fig. 10).  
3. **Generalization**: Personalized model trained on 90–120° sinusoid yields lower RMSE for higher frequency (0.25 Hz) and wider angles (90–130°) (Table I).  
4. **Control comparison**: KMPC outperforms PID in passive and active tasks for majority (Fig. 11); margins of 0.5–1.5° on average.  
5. **Safety & Comfort**: No adverse events; participants reported no discomfort.

---

## Discussion & Analysis  

- **Model fidelity**: The linear Koopman approximation in a 96‑dim space accurately captures both actuator dynamics and muscle contributions, as demonstrated by the low prediction error and matching key inflection points (Fig. 9b).  
- **EMG as feed‑forward**: The 200 ms electromechanical delay demonstrates the necessity of shifted EMG input in the forward model; without it, prediction over‑estimates muscle influence, causing trajectory lag.  
- **Personalized modelling**: The intrinsic variability (body mass, joint stiffness, muscle force) is embedded implicitly in the data‑driven fit; participants with lower natural torque (e.g., P4) exhibited most improvement from personalisation.  
- **KMPC advantages**: By explicitly including future EMG trajectories, the optimizer can anticipate user assistance, yielding smoother actuator commands and reduced overshoot compared with PID’s reactive nature.  
- **Limitations**:  
  - Requires EMG electrodes → user‑dependent calibration.  
  - 20 ms control cycle assumes modest computational load; scaling to faster movements may need GPU.  
  - Only healthy participants; stroke impairments may introduce new dynamics (e.g., increased delay).  
- **Open questions**:  
  - How would the model behave with higher frequency references or larger amplitude (beyond 90–130°)?  
  - What is the optimal horizon length \(N\) for clinical tasks?  
  - Can a patient‑specific \(δ\) rather than fixed 10 steps improve accuracy?  

---

## Conclusions  

- Designed a compliant, origami‑based pneumatic exoskeleton for knee rehabilitation that balances force, weight, and comfort.  
- Introduced a Deep Koopman Network that maps the knee angle and actuator + muscle inputs to a linear Koopman dynamics with explicit EMG feed‑forward.  
- Demonstrated that the resulting KMPC can reliably track reference trajectories with lower error than conventional PID in both passive and active modes.  
- Showed that personalizing the Koopman model to each participant markedly improves performance, suggesting a path toward individualized rehabilitation systems.  
- Future work: clinical trials with stroke patients, integration of adaptive delay estimation, and real‑time computational refinement.

---

## Key Claims & Contributions  

1. **Claim**: Origami‑inspired pneumatic actuator provides high torque‑pressure coefficient over the required knee range; **Evidence**: Fig. 3 torque plots.  
2. **Claim**: DKN accurately models human‑robot dynamics; **Evidence**: Low prediction error (Fig. 9a), 16‑step fidelity (Fig. 9b).  
3. **Claim**: EMG input reduces model error; **Evidence**: Comparison of models in Fig. 9a.  
4. **Claim**: Personalized DKN outperforms non‑personalized; **Evidence**: Table I, Fig. 10.  
5. **Claim**: KMPC yields lower tracking error than PID; **Evidence**: Table II, Fig. 11.  

---

## Definitions & Key Terms  

- **Koopman Operator**: Linear operator in an infinite‑dim space that evolves observables of nonlinear systems.  
- **Deep Koopman Network (DKN)**: Neural encoder–matrix–decoder structure that approximates the finite‑dim Koopman operator from data.  
- **PWM Duty Cycle**: Binary on/off airflow control normalized to [−1, +1] to drive pump speed.  
- **EMG (Electromyography)**: Surface measurement of muscle electrical activity.  
- **IMU (Inertial Measurement Unit)**: 9‑DOF sensor used to compute knee joint angle.  
- **KMPC (Koopman Model Predictive Control)**: Model predictive controller that uses Koopman dynamics and future EMG as known inputs.  
- **Δt**: Discrete sampling period (20 ms).  
- **δ**: Electromechanical delay (10 steps ≈ 200 ms).  
- **A, B, C**: DKN matrices: state transition, input mapping, reconstruction.  

---

## Important Figures & Tables (summary)  

- **Fig. 1**: actuator geometry under negative/positive pressure.  
- **Fig. 2**: full exoskeleton with connectors & straps.  
- **Fig. 3**: torque coefficient vs. angle and design choice of connector angles.  
- **Fig. 4**: EMG & IMU placement.  
- **Fig. 5**: pneumatic drive block diagram.  
- **Fig. 6**: DKN encoder & linear dynamics.  
- **Fig. 7**: experimental workflow (data acquisition, DKN training, rehabilitation).  
- **Fig. 8**: experimental interface & scenario.  
- **Fig. 9**: prediction error & 16‑step prediction.  
- **Table I**: RMSE for personalized vs non‑personalized across frequencies & ranges.  
- **Table II**: KMPC vs PID RMSE per participant.  
- **Fig. 10**: error matrix for personalized vs non‑personalized.  
- **Fig. 11**: error histograms.  

---

## Limitations & Open Questions  

- **Sensor dependency**: PR requires EMG and IMU; placement variability may affect reproducibility.  
- **Delay assumption**: Fixed δ may not capture individual electromechanical delays; adaptive estimation could improve accuracy.  
- **Scalability**: Only 5 healthy participants; unknown performance on stroke patients with impaired muscle tone.  
- **Task scope**: Only seated knee flexion/extension; would model extend to walking or standing?  
- **Computational load**: 20 ms control cycle could strain embedded microcontroller in larger setups.  

---

## References to Original Sections  

| Section in Paper | Key Content |
|------------------|-------------|
| §I Introduction | Motivation & background |
| §II Hardware Design | Actuator, connectors, sensors, drive |
| §III Methods | DKN formulation, training, KMPC |
| §IV Experiments | Data acquisition, DKN validation, personalization, KMPC vs PID |
| §V Conclusion | Summary, future work |
| Fig. 1–11 | Visual representations of design & results |

---

*End of Summary.*