## Safety-Critical Control with Bounded Inputs: A Closed-Form Solution for Backup Control Barrier Functions

David E. J. van Wijk 1 , Ersin Da¸ s 1 , Tamas G. Molnar 2 , Aaron D. Ames 1 , and Joel W. Burdick 1

Abstract -Verifying the safety of controllers is critical for many applications, but is especially challenging for systems with bounded inputs. Backup control barrier functions (bCBFs) offer a structured approach to synthesizing safe controllers that are guaranteed to satisfy input bounds by leveraging the knowledge of a backup controller. While powerful, bCBFs require solving a high-dimensional quadratic program at runtime, which may be too costly for computationally-constrained systems such as aerospace vehicles. We propose an approach that optimally interpolates between a nominal controller and the backup controller, and we derive the solution to this optimization problem in closed form. We prove that this closedform controller is guaranteed to be safe while obeying input bounds. We demonstrate the effectiveness of the approach on a double integrator and a nonlinear fixed-wing aircraft example.

## I. INTRODUCTION

Controlling dynamic systems with constraints that arise from physical limitations, environmental interactions, or user-defined requirements is a fundamental aspect of control applications. As such, constrained control [1]-also called safety-critical control when constraints encode safety requirements [2]-has become a top priority in many autonomous or semi-autonomous cyber-physical systems ranging from robotics to aeronautics. Control barrier functions (CBFs) [3] have emerged as a framework for synthesizing safe controllers that guarantee the forward invariance of a specified safe set. While CBFs have demonstrated success in ensuring safety in many domains [4], [5], they also highlight certain challenges. Namely, conventional CBFs require one to verify that the safe control inputs are feasible at all points within the safe set, which may be difficult in the presence of input constraints.

Motivated by this feasibility challenge, backup control barrier functions (bCBFs) [6] have been proposed to provide theoretical guarantees for the safety of control systems with input bounds. The bCBF technique is applicable for complex nonlinear systems, and has shown success across a wide range of applications [7]-[15]. However, a potential downside of this approach is its online computational requirements: it involves solving a quadratic program (QP) with a large number of constraints at run-time, and to construct these constraints, one must forward integrate a number of ordinary differential equations (ODEs) whose

*This work was supported by DARPA under the LINC Program and the AFOSR Test and Evaluation program, grant FA9550-22-1-0333.

1 Mechanical and Civil Engineering, California Institute of Technology, Pasadena, CA 91125, USA, {vanwijk, ersindas, ames, jburdick}@caltech.edu .

2 Mechanical Engineering, Wichita State University, Wichita, KS 67260, USA, tamas.molnar@wichita.edu .

Fig. 1. Overview of the proposed safety-critical control synthesis framework, illustrated on a fixed-wing aircraft geofencing scenario. Our optimally interpolated (OI) controller guarantees the safety of nonlinear affine systems with input bounds and is obtained in closed-form.

<!-- image -->

number increases quadratically with the state dimension. This may not be feasible for high-dimensional nonlinear systems with limited online computational resources, such as aerospace vehicles. Thus, many safety-critical control solutions for aerospace vehicles have utilized CBFs rather than bCBFs (see e.g., [16]-[20]).

To remedy this, the authors of [21], [22] have introduced a technique for safe controller synthesis that builds on the concept of bCBFs without requiring optimization for the safe input. Instead, this method - which we call safe blending - utilizes a smooth blending function to safely combine a nominal controller and a backup controller. This approach does not require expensive gradient computations, nor does it involve solving a QP online. While effective, this solution is inherently sub-optimal, as the blending function is chosen subjectively and must be hand-tuned. Furthermore, this approach may exhibit undesirable oscillations when the nominal and backup controllers act against each other, resulting in controller chattering and degraded system performance.

Inspired by these previous works, we propose a mid- dle ground between the bCBF and the blended approach. Our main contribution is the optimally interpolated (OI) controller-a novel safety-critical control technique for systems with bounded inputs (see Figure 1). The proposed method optimally interpolates between a nominal controller and a pre-verified backup controller to ensure that the dynamical system remains within a controlled invariant safe set for all time. We derive a closed-form expression for the optimal safe controller, and prove that this solution is feasible even in the presence of input bounds. We demonstrate that the proposed OI controller does not experience the undesirable oscillations observed for the blending approach. Furthermore, compared to the bCBF approach, the number of ODEs to be integrated is smaller, while the closedform expression eliminates the need for solving a highdimensional QP numerically.

The rest of the paper is organized as follows. Section II overviews CBFs and bCBFs. Section III discusses the function-based controller blending method. In Section IV, we present the proposed optimally interpolated safety-critical control approach. In Section V, we cover the results of our numerical simulations, and we conclude with Section VI.

## II. PRELIMINARIES

## A. Control Barrier Functions

Consider a nonlinear control affine system of the form

<!-- formula-not-decoded -->

where f : X → R n and g : X → R n × m are smooth functions. We assume that U is an m -dimensional convex polytope. For an initial condition x (0) = x 0 ∈ X , if u is given by a locally Lipschitz feedback controller k : X → U , u = k ( x ) , the closed-loop system has a unique solution.

Safety is defined by membership to a set C S , and safe controllers render this safe set forward invariant.

Definition 1. A set C ⊆ R n is forward invariant along the closed-loop system if x (0) ∈ C = ⇒ x ( t ) ∈ C , for all t &gt; 0 .

Consider the safe set C S ≜ { x ∈ X : h ( x ) ≥ 0 } as the 0-superlevel set of a continuously differentiable function h : X → R , where the gradient of h along the boundary of C S is nonzero. The function h is a CBF [3] for (1) on C S if there exists a classK ∞ function 1 α such that for all x ∈ C S

<!-- formula-not-decoded -->

Theorem 1 ([3]) . If h is a CBF for (1) on C S , then any locally Lipschitz controller k : X → U , u = k ( x ) satisfying

<!-- formula-not-decoded -->

for all x ∈ C S renders the set C S forward invariant.

For an arbitrary primary or nominal controller , k p : X → U , one can ensure the safety of (1) by solving a

1 A function α : R ≥ 0 → R ≥ 0 is of classK ∞ if it is continuous, strictly increasing, α (0) = 0 , and lim r →∞ α ( r ) = ∞ .

quadratic program (QP) for the safe control, k safe : X → U :

<!-- formula-not-decoded -->

If h is a CBF, then the (CBF-QP) is feasible, and when U = R m , its closed-form solution becomes [23]

<!-- formula-not-decoded -->

where ˆ a and ˆ b stem from the coefficients in the constraint:

<!-- formula-not-decoded -->

whereas λ is defined using ReLU( · ) ≜ max { 0 , ·} as

<!-- formula-not-decoded -->

Ensuring the feasibility of the (CBF-QP) can be challenging, especially for high dimensional systems. This motivates the use of an extension of CBFs known as backup CBFs.

## B. Backup Control Barrier Functions

Backup CBFs (bCBFs) [6], [24] can overcome the feasibility issue of traditional CBFs by constructing controlled invariant sets at run-time for systems with input constraints.

Definition 2. A set C ⊆ R n is controlled invariant if there exists a controller k : X → U , u = k ( x ) rendering C forward invariant for (1), with u ∈ U .

First, one must obtain a controlled invariant subset of C S , known as the backup set :

<!-- formula-not-decoded -->

where h b : X → R is continuously differentiable with a nonzero gradient along the boundary of C B . Second, one must define a smooth backup control law k b : X → U which renders the backup set forward invariant along the system

<!-- formula-not-decoded -->

Finding a small controlled invariant subset of C S is typically much easier than verifying that C S itself is controlled invariant. For example, a backup set can often be defined by a level set of a quadratic Lyapunov function centered on a stabilizable equilibrium point for the linearized dynamics, and can be rendered forward invariant by a simple feedback controller [24]. One could directly constrain the system (1) to operate within C B to guarantee safety. However, as C B may be a very small subset of C S , this would lead to conservative behavior. Instead, it is possible to expand this set implicitly, thereby obtaining a new, larger controlled invariant set.

To construct a controlled invariant set online, we allow the system to evolve beyond C B by forward integrating the backup dynamics (6) over a finite horizon. If the system can stay in C S and safely reach C B from the current state using k b , this state is classified as safe. More precisely, the controlled invariant set, C I ⊆C S , is defined as

<!-- formula-not-decoded -->

where ϕ b ( τ, x ) is the flow of the backup system (6) over the interval τ ∈ [0 , T ] for a horizon T &gt; 0 starting at state x :

<!-- formula-not-decoded -->

This definition gives recursive feasibility guarantees under input constraints.

Lemma 1 ([24][25, Lem. 1]) . The set C I is controlled invariant, and the backup controller k b renders C I forward invariant along (6) as x ∈ C I = ⇒ ϕ b ( τ, x ) ∈ C I ⊆ C S , ∀ τ ≥ 0 .

As a direct consequence of Lemma 1, the backup control law can be shown to satisfy safety constraints similar to (2).

Lemma 2 ([24][25, Lem. 2]) . There exist classK ∞ functions α , α b such that

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

for all τ ∈ [0 , T ] and x ∈ C I .

This therefore leads to the main result of backup CBFs.

Theorem 2 ([24]) . There exist classK ∞ functions α , α b and a locally Lipschitz controller k : X →U , u = k ( x ) satisfying

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

for all x ∈ C I . Such a controller renders C I ⊆ C S forward invariant and satisfies input constraints.

Proof. By Lemma 1, the backup control law k b is one such Lipschitz controller. Applying Theorem 1 to system (1), the satisfaction of (10) yields the forward invariance of C I . ■

Because (10a) represents an infinite number of constraints, in practice the constraint is discretized and enforced at discrete points along the flow, such that τ ∈ { 0 , ∆ , . . . , T } where ∆ &gt; 0 is a discretization step satisfying T/ ∆ ∈ N . Then, one can construct a point-wise optimization problem for the least-invasive safe control signal, like the (CBF-QP):

<!-- formula-not-decoded -->

Corollary 1. There exist classK ∞ functions α , α b such that the optimization problem posed in (bCBF-QP) is feasible for all x ∈ C I , even if h is not a CBF.

Thus, bCBFs are powerful tools for guaranteeing safety of nonlinear affine systems in the presence of input constraints. However, the price for the feasibility guarantees endowed by bCBFs is additional computation. Computing the total derivatives of h and h b :

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

where ˙ x = f ( x ) + g ( x ) u , and Φ b ( τ, x ) ≜ ∂ ϕ b ( τ, x ) ∂ x , requires solving a coupled initial value problem for the sensitivities of the flow to changes in the initial condition. Namely, the sensitivity matrix Φ b ( τ, x ) is the solution to

<!-- formula-not-decoded -->

where F cl ( x ) = ∂f cl ( x ) /∂ x is the Jacobian of f cl in (6), that is evaluated at ϕ b ( τ, x ) , and I is the n × n identity matrix.

To compute the constraints in (10), at each time step one must forward integrate n + n 2 ordinary differential equations (ODEs) in (8) and (12). For many applications this may be allowable, but for resource-constrained platforms, such as aerospace systems, computing these gradients may be a bottleneck, especially if the backup horizon is long. Further, formal system certification requirements may exclude methods that numerically solve a high-dimensional QP online.

## III. FUNCTION-BASED CONTROLLER BLENDING

While bCBFs offer an elegant solution to feasible safetycritical control, their main downside is the additional computation requirements. To overcome this downside, the authors of [21] offer a solution deemed safe blending , which seeks to mix the control inputs from the nominal and the backup controller, to obtain a safe but more performant controller than just the backup controller alone. This blended or mixed controller k m : X → U is written as

<!-- formula-not-decoded -->

where µ : R n → [0 , 1] is a blending function that regulates the portion that the backup and primary control signals contribute to the mixed control signal. It is trivial to verify that restricting the range of µ from [0 , 1] guarantees that for all x ∈ X , k m ( x ) ∈ U as long as k p ( x ) , k b ( x ) ∈ U and U is convex.

To ensure safety with the mixed controller, the authors of [21] define a function h I associated with the set C I in (7) as

<!-- formula-not-decoded -->

Using this definition, a blending function is proposed as

<!-- formula-not-decoded -->

where Λ : R → [0 , 1] is a continuous function that satisfies Λ( r ) = 1 when r ≤ 0 , and d Λ dr &lt; 0 when r &gt; 0 . For example,

<!-- formula-not-decoded -->

with η &gt; 0 . This particular choice of blending function and blending controller is provably safe.

Proposition 1 ([22, Proposition 1]) . Any locally Lipschitz mixed controller k m : X → U given by (13) , with a blending

Fig. 2. Simulation of the double integrator (16) comparing the (bCBF-QP) (black), the function-based blended controller in (13) with tuning parameter (14)-(15) (pink) and the proposed (OI-QP) approach (green dashed). The blended controller experiences undesirable oscillations at the boundary of the safe region ( top ), while our approach does not. In this scenario, our approach is equivalent to the (bCBF-QP) ( bottom right ), but with significantly less computational overhead.

<!-- image -->

function µ in (14) and Λ : R → [0 , 1] satisfying Λ(0) = 1 , renders C I forward invariant along (1) .

Proof. At the boundary of C I , where h I ( x ) = 0 , the blending parameter in (13) is µ ( x ) = 1 and the mixed controller in (14) reduces to k m ( x ) = k b ( x ) . Therefore, because the set C I is forward invariant under the backup controller based on Lemma 1, C I is rendered forward invariant under k m as well. Furthermore, k m ( x ) ∈ U for all x ∈ X by design. ■

The mixed controller in (13) is not only provably safe, but it also circumvents the need to solve an optimization problem online and to calculate the sensitivity of the backup flow by solving n 2 ODEs in (12). However, the mixed controller can lead to undesirable behavior near the boundary of C I if the goals of the primary controller and backup controller conflict. We use a simple example to highlight this point.

Example 1 (Double Integrator) . Consider a double integrator system as in [8] given by

<!-- formula-not-decoded -->

with position x 1 , velocity x 2 , state x = [ x 1 x 2 ] ⊤ ∈ R 2 , and control input u ∈ U = [ -1 , 1] . The safe set is defined as the left half-plane

<!-- formula-not-decoded -->

The backup control law, k b ( x ) = -1 , brings the system to the backup set C B ≜ { x ∈ R 2 : -x 1 ≥ 0 , -x 2 ≥ 0 } and renders C B forward invariant. The primary controller, k p ( x ) = 1 , drives (16) to the unsafe right half-plane.

Figure 2 compares the (bCBF-QP) to the blended controller from (13) using the blending function in (14)-(15). Initially, the behavior of the controllers is similar; however, at the origin, the blended controller exhibits undesirable oscillations. This is due to the competing goals of the backup and the primary controller, which the blended controller mixes. The primary controller seeks to enter the right halfplane while the backup controller seeks to apply maximum braking. Thus, near the boundary of the safe set, the blended controller modulates the importance between these two control signals, but cannot do so in an optimal manner, as done by the (bCBF-QP). This motivates our central contribution to find a simple and computationally efficient method for inputconstrained safe control without such undesirable behavior.

## IV. OPTIMAL CONTROLLER INTERPOLATION

As discussed in Section III, the main advantage of function-based blending is that it is a gradient-free approach (i.e., computing the sensitivity via (12) is not needed) and it does not require solving a QP online. However, the choice of blending function is subjective and may lead to undesirable behavior (see Example 1). Therefore, we propose a middle ground between function-based blending and the (bCBF-QP), which seeks to select an optimal blending parameter.

We introduce the following optimization problem, where the parameter µ is minimized subject to conditions on the forward invariance of the implicit set C I ⊆ C S , which we denote as the optimally interpolated (OI) controller:

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

Based on (13), the total derivatives are computed as

<!-- formula-not-decoded -->

leading to a QP with affine constraints in µ .

Similar to the (bCBF-QP), the (OI-QP) can be shown to be feasible and guarantee safety.

Lemma 3. There exist classK ∞ functions α , α b such that the (OI-QP) is feasible for all x ∈ C I .

Proof. Based on (17), the constraints of the (OI-QP) reduce to those in (9) for µ = 1 . Therefore, based on Lemma 2, there exist α , α b such that µ = 1 satisfies the constraints of the optimization problem, which implies feasibility. ■

Theorem 3. Consider the system (1) with a primary controller k p , a backup controller k b , and the set C I in (7) . The controller k ⋆ m : X → U given by

<!-- formula-not-decoded -->

where µ ⋆ ( x ) satisfies the (OI-QP) , renders C I ⊆ C S forward invariant and satisfies the input constraint, k ⋆ m ( x ) ∈ U for all x ∈ X .

Proof. The forward invariance of C I follows from Theorem 2, since the controller in (18) satisfies the constraints in (10) by construction. The controller in (18) satisfies the input constraint because for all x ∈ X , k p ( x ) ∈ U , k b ( x ) ∈ U , µ ⋆ ( x ) ∈ [0 , 1] , and U is convex. ■

While maintaining feasibility and safety, the (OI-QP) offers major computational advantages over the (bCBF-QP). Namely, the (OI-QP) can be solved in closed-form, which eliminates the need for implementing a high-dimensional QP solver. Moreover, the number of ODEs to be integrated at each time step can be reduced by using the (OI-QP). At the same time, the (OI-QP) can also eliminate the undesirable behavior observed for the function-based blending approach. We demonstrate these properties next. We remark that the price of these benefits is the restriction of the control input to the linear combination of the primary and backup control signals as in (18) as opposed to the (bCBF-QP) that offers a point-wise optimal input from the entire input set U .

## A. Closed-form Solution for Optimal Interpolation

First, we present the solution of the (OI-QP) in closedform. As a preliminary, we introduce the notation:

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

which simplifies the constraints to a ( τ, x ) + b ( τ, x ) µ ≥ 0 and a b ( x ) + b b ( x ) µ ≥ 0 . Then, as for the (bCBF-QP), we discretize the constraints on the safety of the backup flow by introducing a i ( x ) = a ( τ i , x ) and b i ( x ) = b ( τ i , x ) with τ i = i ∆ , ∆ = T/N , i ∈ { 0 , 1 , . . . , N } . This leads to

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

where I = { 0 , 1 , . . . , N +3 } , whereas a N +1 ( x ) = a b ( x ) , b N +1 ( x ) = b b ( x ) , while the domain µ ∈ [0 , 1] is captured by a N +2 ( x ) = 0 , b N +2 ( x ) = 1 , a N +3 ( x ) = 1 , b N +3 ( x ) = -1 .

## Theorem 4. The QP (20) has the closed-form solution

<!-- formula-not-decoded -->

where I + ( x ) ≜ { i ∈ I : b i ( x ) &gt; 0 } .

Proof. We first notice that the constraints of the discretized QP (20) are a subset of the constraints of the (OI-QP). Therefore, the QP (20) is feasible by Lemma 3 (considering appropriate α and α b ) . Because the primal problem in (20) is a QP and is feasible, Slater's conditions hold and thus strong duality holds. Therefore, any points ( µ ⋆ , λ i ) that satisfy the

Karush-Kuhn-Tucker (KKT) conditions are primal and dual optimal, and have zero duality gap [26, Ch. 5]. That is, the solution of the QP (20) must satisfy the KKT conditions:

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

for all i ∈ I . Note that, throughout this proof, we omit the dependencies on x to simplify our notation.

For ease of notation, let j ≜ argmax i ∈I + {-a i /b i } . If multiple indices yield the maximum, j can be any of them. We prove that the KKT conditions in (22) are satisfied by

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

where µ ⋆ matches (21). Note that, by definition of j ,

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

where a j ≤ 0 holds because a N +2 = 0 and b N +2 = 1 . Then, the expressions in (23) satisfy (22d) because

<!-- formula-not-decoded -->

The condition in (22c) holds, because (23b) gives λ i = 0 for i ∈ I \{ j } , whereas (23a) gives a i + b i µ ⋆ = 0 for i = j . The condition in (22b) holds with (23b) and (23c)-(24b).

Finally, to show that (22a) holds, we leverage the fact that the QP (20) is feasible (per Lemma 3), that is, there exists µ such that a i + b i µ ≥ 0 for all i ∈ I . This implies a i ≥ 0 for b i = 0 , µ ≤ -a i /b i for b i &lt; 0 , and µ ≥ -a i /b i for b i &gt; 0 . Therefore, the following must hold for µ to exist:

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

where (25b) ensures that the upper bounds on µ are higher than the lower bounds. Then, (22a) is satisfied because

<!-- formula-not-decoded -->

where the last inequality holds for b i = 0 due to (25a), for b i &gt; 0 because of (24a), and also for b i &lt; 0 due to (25b). Thus, the expressions in (23) satisfy all the conditions for primal and dual optimality. ■

The solution (21) of the QP (20) and the corresponding controller can be written equivalently as

<!-- formula-not-decoded -->

with λ in (4), where we used a N +2 ( x ) = 0 , b N +2 ( x ) = 1 . Notice the similarity to the solution (3) of the (CBF-QP). While the (CBF-QP) combines the primary controller k p with the input ( ∇ h ( x ) · g ( x )) ⊤ , that represents the safest control direction based on h , the proposed QP (20) blends k p with the backup controller k b to ensure the satisfaction of input constraints in addition to safety.

By refining the discretization and taking the continuous limit ( N →∞ ), the solution (26) of the discretized QP (20) leads to the closed-form solution of the (OI-QP):

<!-- formula-not-decoded -->

where a , b , a b , b b are defined in (19), while λ is given by (4).

## B. Sensitivity Computations for Optimal Interpolation

Next, we establish that the (OI-QP) requires fewer ODEs to be integrated than the (bCBF-QP). In the form (17), the derivatives can be computed exactly :

<!-- formula-not-decoded -->

where q p ( τ, x ) ≜ Φ b ( τ, x ) ( f ( x ) + g ( x ) k p ( x ) ) and q b ( τ, x ) ≜ Φ b ( τ, x ) ( f ( x ) + g ( x ) k b ( x ) ) are the push forward of the dynamics, representing the change of the backup flow under k p and k b , respectively.

Although these terms involve the sensitivity matrix Φ b ( τ, x ) , the key intuition is that we do not need to compute the entire sensitivity matrix by solving (12). Instead, we only need to obtain directional components of the sensitivity matrix, by solving the following initial value problems:

<!-- formula-not-decoded -->

where f p ( x ) ≜ f ( x ) + g ( x ) k p ( x ) , while f cl is given in (6), and F cl ( x ) = ∂f cl ( x ) /∂ x ; cf. (12).

Thus, this method requires integrating forward 3 n ODEs, given by (8) and (29), rather than the n + n 2 ODEs required by the standard bCBF approach, reducing the number of ODEs if n ≥ 2 . This may save a significant amount of computation for high-dimensional systems.

The downside to this approach (and the approach in Section III) is that the components of the backup and primary controllers are mixed with equal weighting. To improve performance, one could construct an optimization problem similar to that posed in (OI-QP), but for a multi-dimensional blending variable, µ = [ µ 1 µ 2 . . . µ m ] ⊤ with the corresponding mixed controller k m ( x ) = k p ( x ) + ∆ u ( x ) µ ( x ) where ∆ u ( x ) ≜ diag( k b ( x ) -k p ( x )) . Unlike the onedimensional case, this setup has no simple closed-form solution, but requires standard iterative QP solving methods to solve for the optimal µ vector (see e.g., active set methods [27, Ch. 16]). Thus, we opt for the interpolation approach, as it can be solved in closed-form, providing significant computational savings.

## V. SIMULATION RESULTS

To demonstrate the effectiveness of the proposed approach, we consider two simulation examples: the running double integrator example, and a nonlinear fixed-wing aircraft model 2 .

## A. Double Integrator

We consider the same setup as in Example 1, and compare the optimally interpolated controller (18) with the (bCBF-QP) from Section II-B and the blended controller (13) from Section III. Figure 2 demonstrates that our approach eliminates the undesired oscillations at the boundary of C S . While the blended approach subjectively selects µ , our approach chooses the optimal value, which yields a safe controller with better performance. We note that for this very special case, the (bCBF-QP) and the (OI-QP) are equivalent. Because there is a single input, and the primary and backup controllers are state-independent signals on either extreme of the domain U , the (OI-QP) can search over the entire domain of inputs to find a feasible, safe controller.

## B. Fixed-Wing Aircraft

Next, consider a nonlinear fixed-wing aircraft model [28]:

<!-- formula-not-decoded -->

which is derived by assuming that the angle of attack and the angle of side slip are zero, the load factor dynamics and roll mode are modeled as a first-order system, and that gravity and load factor are the only accelerations on the aircraft. In (30), the states ϕ , θ , ψ , p N , p E , H , and P , and N z represent the roll, pitch, and yaw angles, the north and east position coordinates, altitude, roll rate, and normal load factor, respectively. The constants V T , g D , τ p and τ z are the true airspeed, gravitational acceleration, and the time constants for the roll mode and load factor dynamics, respectively. The bounded inputs are the commanded roll rate u 1 ∈ [ -π 2 , π 2 ] rad / s and commanded load factor u 2 ∈ [ -1 , 4] (representing normal accelerations measured in g D that pull the aircraft up).

We consider a scenario where the aircraft must stay within a prespecified airspace, described by a geofence with a

2 Code is available at: https://github.com/davidvwijk/OI-CBF

Fig. 3. Simulation of the fixed-wing aircraft (30) comparing the (bCBF-QP) (black), the function-based blended controller in (13) (pink) and the proposed (OI-QP) approach (green). The (bCBF-QP) and (OI-QP) ensure the safety of (30) by avoiding crossing the geofence (blue) and gliding near its surface ( top left ). The blended controller also ensures safety but experiences oscillations along the geofence ( top right ), causing hysteresis most notably in the roll rate command ( a ) as the blending parameter switches between 0 and 1 ( b ). This in turn produces stark oscillations in the aircraft's roll angle, which is highly undesirable for stable flight ( e ). In contrast, the (OI-QP) smoothly interpolates between k b and k p ( b ) to guarantee the safety of the aircraft ( d ), whilst avoiding evaluating a QP online as required by the (bCBF-QP). Further, the closed-form solution from Theorem 4 always yields a safe control signal which respects the input bounds, as per Lemma 3.

<!-- image -->

known location p g ∈ R 2 and normal vector n g ∈ R 2 with ∥ n g ∥ = 1 . The safe set can be written as

<!-- formula-not-decoded -->

where p = [ p N p E ] ⊤ . The nominal controller seeks to push the aircraft into the geofence while the backup controller executes a coordinated turn with k b ( x ) = [ u b1 u b2 ] ⊤ where

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

<!-- formula-not-decoded -->

and K ϕ , K p , K N , K H , K θ &gt; 0 are gains, H ∗ is the altitude, ϕ ∗ ∈ [ -π 4 , π 4 ] is the bank angle, and N ∗ z = 1 / cos( ϕ ∗ ) is the load factor in the turn. Note that u b1 and u b2 are saturated using a softplus function which retains the smoothness of f cl . Such a controller drives the aircraft to a circular path and renders the following set forward invariant:

<!-- formula-not-decoded -->

with

<!-- formula-not-decoded -->

Here, ρ = V 2 T / ( g D tan( ϕ ∗ )) is the turning radius under k b and c 6 &gt; 0 . This backup set describes the set of periodic orbits whose centers are at least ρ + c 6 away from the geofence, at a height of H ∗ .

Proposition 2. The backup set C B in (33) is forward invariant for the system (30) with the backup controller (32) , and it satisfies C B ⊆ C S for the safe set in (31) .

Proof. For all x ∈ C B , the states ϕ, θ, H, P, and N z are constant along the closed-loop backup dynamics under the backup control law (32). The backup flow of the yaw angle evolves with ∂ ∂τ ψ b ( τ, x ) = V T /ρ which has the solution ψ b ( τ, x ) = ( V T /ρ ) τ + ψ . Similarly, the closed-form solution for the backup flow of the position of the aircraft is

<!-- formula-not-decoded -->

Thus, using (34), it can be verified that h 6 ( p b ( τ, x )) ≥ 0 along the backup flow for all x ∈ C B and τ ≥ 0 :

<!-- formula-not-decoded -->

Further, because ρ ( n g · n ( ψ ) -1 ) ≤ 0 and -c 6 ≤ 0 , we have h ( x ) ≥ h 6 ( x ) for all x ∈ X , and thus C B ⊆ C S . ■

In practice, a neighborhood of C B may be used as a backup set. Such a set can be constructed via h 1 ( x ) = c 2 1 -( ϕ ∗ -ϕ ) 2 , h 2 ( x ) = c 2 2 -θ 2 , h 3 ( x ) = c 2 3 -( H ∗ -H ) 2 , h 4 ( x ) = c 2 4 -P 2 , h 5 ( x ) = c 2 5 -( N ∗ z -N z ) 2 with constants c 1 , c 2 , c 3 , c 4 , c 5 &gt; 0 . Namely, one may use a smooth under-approximation of the minimum of these functions as in [29], [30]:

<!-- formula-not-decoded -->

with smoothing parameter κ &gt; 0 and I = { 1 , . . . , 6 } .

The nominal controller uses (32) but with a desired roll angle ϕ ∗ = sat( K ψ ( ψ ∗ -ψ ) V T /g D ) and yaw angle ψ ∗ = arctan(( p ∗ E -p E ) / ( p ∗ N -p N )) ∈ S 1 , where K ψ &gt; 0 and p ∗ E , p ∗ N is a desired setpoint which is purposefully placed far behind the geofence.

Figure 3 shows the simulation results for system (30) comparing the methods from Sections II-B and III with the proposed (OI-QP) controller 3 . The (OI-QP) guarantees the

3 The simulation uses g D =9 . 81m / s 2 , V T =200m / s , τ p =1s , τ z =1s , ϕ ∗ = -π 4 rad , H ∗ =10km .

safety of the aircraft by smoothly selecting the parameter µ ⋆ ( x ) which minimizes the utilization of k b , whilst ensuring that (30) stays within the controlled invariant set C I defined in (7). Thanks to Theorem 3 and Theorem 4, this controller satisfies the safety constraint, and the optimal blending parameter µ ⋆ ( x ) is obtained in closed-form. Further, this parameter ensures that the safe controller always satisfies input constraints, as can be seen in Figure 3. While the (bCBF-QP) ensures the safety of (30) under input bounds, it requires solving a QP with a very large number of constraints online, and forward integrating a large number of ODEs (i.e., n 2 + n = 72 ODEs, while the optimal interpolation uses 3 n = 24 ODEs). The blended approach (13)-(15) also obeys the geofence constraint and the input bounds, but experiences hysteresis and subsequent oscillations near the geofence.

## VI. CONCLUSION

We presented a novel framework to guarantee the safety of nonlinear control-affine systems by optimally interpolating between a verified backup controller and a nominal controller. We derived a closed-form solution for the resulting safe controller, and proved that this controller respects input bounds while guaranteeing safety. Through simulations, including a double integrator and a geofencing scenario on a fixed-wing aircraft, we demonstrated the overall performance improvement of our approach over the existing function-based controller blending method. This advancement simplifies the deployment of bCBF-based safety filters, providing feasibility guarantees in computationally limited systems. Future work will explore OI-QP implementations on computationally-constrained hardware platforms such as a fixed-wing aircraft.

## REFERENCES

- [1] D. Q. Mayne, J. B. Rawlings, C. V. Rao, and P. O. Scokaert, 'Constrained model predictive control: Stability and optimality,' Automatica , vol. 36, no. 6, pp. 789-814, 2000.
- [2] K.-C. Hsu, H. Hu, and J. F. Fisac, 'The safety filter: A unified view of safety-critical control in autonomous systems,' Annual Review of Control, Robotics, and Autonomous Systems , vol. 7, 2023.
- [3] A. D. Ames, X. Xu, J. W. Grizzle, and P. Tabuada, 'Control barrier function based quadratic programs for safety critical systems,' IEEE Transactions on Automatic Control , vol. 62, no. 8, pp. 3861-3876, 2017.
- [4] K. P. Wabersich, A. J. Taylor, J. J. Choi, K. Sreenath, C. J. Tomlin, A. D. Ames, and M. N. Zeilinger, 'Data-driven safety filters: Hamilton-Jacobi reachability, control barrier functions, and predictive methods for uncertain systems,' IEEE Control Systems Magazine , vol. 43, no. 5, pp. 137-177, 2023.
- [5] K. Garg, J. Usevitch, J. Breeden, M. Black, D. Agrawal, H. Parwana, and D. Panagou, 'Advances in the theory of control barrier functions: Addressing practical challenges in safe control synthesis for autonomous and robotic systems,' Annual Reviews in Control , vol. 57, p. 100945, 2024.
- [6] T. Gurriet, M. Mote, A. D. Ames, and E. Feron, 'An Online Approach to Active Set Invariance,' in 57th IEEE Conference on Decision and Control , pp. 3592-3599, 2018.
- [7] K. Dunlap, M. Hibbard, M. Mote, and K. Hobbs, 'Comparing run time assurance approaches for safe spacecraft docking,' IEEE Control Systems Letters , vol. 6, pp. 1849-1854, 2022.
- [8] D. E. J. van Wijk, S. Coogan, T. G. Molnar, M. Majji, and K. L. Hobbs, 'Disturbance-robust backup control barrier functions: Safety under uncertain dynamics,' IEEE Control Systems Letters , vol. 8, pp. 28172822, 2024.
- [9] K. L. Hobbs, M. L. Mote, M. C. Abate, S. D. Coogan, and E. M. Feron, 'Runtime assurance for safety-critical systems: An introduction to safety filtering approaches for complex control systems,' IEEE Control Systems Magazine , vol. 43, no. 2, pp. 28-65, 2023.
- [10] T. Gurriet, Applied Safety Critical Control . PhD thesis, California Institute of Technology, 2020.
- [11] D. Ko and W. K. Chung, 'A backup control barrier function approach for safety-critical control of mechanical systems under multiple constraints,' IEEE/ASME Transactions on Mechatronics , pp. 1-12, 2024.
- [12] W. Zeng, L. Li, H. Xiong, H. Jiang, B. R. Noack, W. Lu, and H. Liu, 'Onboard operational safety filter for a quadrotor in an environment with dynamic obstacles,' IEEE Transactions on Industrial Informatics , vol. 21, no. 5, pp. 3776-3785, 2025.
- [13] N. C. Janwani, E. Da¸ s, T. Touma, S. X. Wei, T. G. Molnar, and J. W. Burdick, 'A learning-based framework for safe human-robot collaboration with multiple backup control barrier functions,' in 2024 IEEE International Conference on Robotics and Automation (ICRA) , pp. 11676-11682, IEEE, 2024.
- [14] P. Rabiee and J. B. Hoagg, 'Soft-minimum and soft-maximum barrier functions for safety with actuation constraints,' Automatica , vol. 171, p. 111921, 2025.
- [15] P. M. Rivera, 'Forward and control invariance analysis of backup control barrier function induced safe sets for online safety of nonlinear systems,' in 63rd Conference on Decision and Control , pp. 81508157, 2024.
- [16] E. Ç. Altunkaya and ˙ I. Özkol, 'Nuisance-free ground collision avoidance design with adaptive exponential control barrier functions,' Journal of Guidance, Control, and Dynamics , pp. 1-15, 2025.
- [17] E. Squires, P. Pierpaoli, R. Konda, S. Coogan, and M. Egerstedt, 'Composition of safety constraints for fixed-wing collision avoidance amidst limited communications,' Journal of Guidance, Control, and Dynamics , vol. 45, no. 4, pp. 714-725, 2022.
- [18] Z. Zheng, J. Li, Z. Guan, and Z. Zuo, 'Constrained moving path following control for UAV with robust control barrier function,' IEEE/CAA Journal of Automatica Sinica , vol. 10, no. 7, pp. 15571570, 2023.
- [19] J. Breeden and D. Panagou, 'Quadratic programs for high relative degree spatial constraints and spatiotemporal specifications with spacecraft applications,' in 59th IEEE Conference on Decision and Control , pp. 1496-1502, 2020.
- [20] T. G. Molnar, S. K. Kannan, J. Cunningham, K. Dunlap, K. L. Hobbs, and A. D. Ames, 'Collision avoidance and geofencing for fixed-wing aircraft with control barrier functions,' IEEE Transactions on Control Systems Technology , vol. 33, no. 5, pp. 1493-1508, 2025.
- [21] A. Singletary, A. Swann, Y. Chen, and A. D. Ames, 'Onboard safety guarantees for racing drones: High-speed geofencing with control barrier functions,' IEEE Robotics and Automation Letters , vol. 7, no. 2, pp. 2897-2904, 2022.
- [22] A. Singletary, T. Gurriet, P. Nilsson, and A. D. Ames, 'Safetycritical rapid aerial exploration of unknown environments,' in IEEE International Conference on Robotics and Automation , pp. 1027010276, 2020.
- [23] M. H. Cohen, P. Ong, G. Bahati, and A. D. Ames, 'Characterizing smooth safety filters via the implicit function theorem,' IEEE Control Systems Letters , vol. 7, pp. 3890-3895, 2023.
- [24] T. Gurriet, M. Mote, A. Singletary, P. Nilsson, E. Feron, and A. D. Ames, 'A scalable safety critical control framework for nonlinear systems,' IEEE Access , vol. 8, pp. 187249-187275, 2020.
- [25] T. G. Molnar and A. D. Ames, 'Safety-critical control with bounded inputs via reduced order models,' in American Control Conference , pp. 1414-1421, 2023.
- [26] S. Boyd and L. Vandenberghe, Convex Optimization . Cambridge University Press, 2004.
- [27] J. Nocedal and S. Wright, 'Numerical optimization,' Springer Series in Operations Research and Financial Engineering , pp. 1-664, 2006.
- [28] S. Stephens, A Real-time Algorithm to Achieve Precise Coordinated Arrival Times in a Time-variant Environment . PhD thesis, Air Force Institute of Technology, 2021.
- [29] L. Lindemann and D. V. Dimarogonas, 'Control barrier functions for signal temporal logic tasks,' IEEE Control Systems Letters , vol. 3, no. 1, pp. 96-101, 2019.
- [30] T. G. Molnar and A. D. Ames, 'Composing control barrier functions for complex safety specifications,' IEEE Control Systems Letters , vol. 7, pp. 3615-3620, 2023.