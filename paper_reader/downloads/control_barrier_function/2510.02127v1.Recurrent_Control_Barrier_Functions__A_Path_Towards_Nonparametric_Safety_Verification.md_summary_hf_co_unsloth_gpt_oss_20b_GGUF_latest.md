**Title & Citation**  
- **Title:** *Recurrent Control Barrier Functions: A Path Towards Non‑Parametric Safety Verification*  
- **Authors:** Jixian Liu & Enrique Mallada  
- **Affiliation:** Department of Electrical and Computer Engineering, Johns Hopkins University, MD 21218, USA  
- **Paper Reference:** Presented by the authors (exact venue not listed, but supported by NSF grant 2330450 and the Johns Hopkins University Institute for Assured Autonomy).  

---

## Abstract  

The authors introduce **Recurrent Control Barrier Functions (RCBFs)**, a new class of Safety Lyapunov‑style functions that relax the strict invariance requirement of classic Control Barrier Functions (CBFs). RCBFs only need trajectories to return to a safe set *within a finite time* (τ) rather than staying inside it at all times.  They show that, under mild regularity conditions, the **signed‑distance** to a compact τ‑recurrent set is a valid RCBF; thus safety reduces to *set identification*, not to the difficult synthesis of a Lyapunov‑like function.  A data‑driven, embarrassingly parallel verification algorithm is proposed, which samples control trajectories, checks the RCBF inequality on small cells, and refines the partition until all points are classified as safe or unsafe.  Experiments on a 3‑D evasion problem demonstrate: (i) the RCBF region always contains the true unsafe region (≥ 100 % coverage); (ii) computation time is far lower than Hamilton–Jacobi (HJ) reachability at equivalent precision levels; and (iii) the optimizer can trade off τ for accuracy (small τ gives tighter safety but increases cost).

---

## Introduction & Motivation  

1. **Safety in dynamical systems** is usually guaranteed either via (i) *Hamilton–Jacobi reachability* (computes the maximal safe set by solving a HJ PDE––curse of dimensionality) or (ii) *Control Barrier Functions* (CBFs)––requires solving a high‑dimensional semidefinite program).  
2. Both approaches suffer from *computation/parameter scalability*.  
3. **Data‑driven** alternatives (DeepReach, Koopman‑based CBFs, neural‑CBFs) improve speed but sacrifice interpretability.  
4. *Recurrence* – the property that a trajectory *returns* to a set after leaving it – has emerged as a looser form of invariance which is *data‑friendly* (Spectra, entropy).  
5. The authors propose to *replace invariance with recurrence* (finite look‑ahead τ) in the CBF context, yielding **RCBFs**.  

---

## Methods / Approach  

### 1. System Model & Regularity  

- Continuous‑time dynamics:  
  \[
  \dot x(t)=F(x(t),u(t)),\qquad x(0)=x,\; u\in U
  \]  
  *Assumptions:* (a) **Forward completeness** – solutions exist for all \(t\ge0\).  
  (b) **Uniform local Lipschitz** – \(F\) is locally Lipschitz in \(x\) with constant \(L\).  

### 2. Safety Definitions  

- **Safe state** – there exists a control steering the trajectory *forever* away from the unsafe set \(X_u\).  
- **Control invariant set** – if \(x\in C\) then \(\exists u\in U\) s.t. \(\forall t\ge0:\, \phi(t,x,u)\in C\).  

### 3. τ‑Recurrent Sets  

- **Definition (control recurrent set)**: \(S\) compact, \(\forall x\in S\;\exists u\in U\;\forall t\ge0:\phi(t,x,u)\in S\).  
- **Definition (control τ‑recurrent)**: same with \(\forall t\ge0:\phi(t,x,u)\in S\) *for all \(t\) that are multiples of τ* (or come back within τ).  

### 4. Recurrent Control Barrier Function (RCBF)  

- **Definition 7 (RCBF)**: Continuous \(h:\mathbb R^n\to\mathbb R\). For all \(x\in D_0:=\{h\le -c\},\,c>0\)  
  \[
  \sup_{0<t\le\tau}\bigl[\gamma(h(\phi(t,x,u)))+\tfrac12\,L\,\gamma\sup_{\|x-y\|\le r}\|x-y\|\bigr]\le0,
  \]  
  for some \(u\in U(0,\tau]\).  
  Here \(\gamma:\mathbb R\rightarrow\mathbb R_+\) is a class‑K extended function and \(r\) is the radius of a ball in which the disturbance bound \(\sup_{\|x-y\|\le r}\|x-y\|\) is taken.  
- **Choice of \(\gamma\):** \(\gamma_{\alpha,\beta}(s)=\alpha\,s^+ - \beta\,s^-\) with \(\alpha,\beta>0\).  

### 5. Key Theorems  

- **Theorem 2 (Safety via RCBF)**  
  (i) If \(h\) is an RCBF then the super‑level set \(h\ge0\) is **control τ‑recurrent**.  
  If moreover \(h\ge0\) is disjoint from the τ‑backward reachable tube of the unsafe set, then \(h\ge0\) is *safe*.  
  (ii) Any controller that makes the trajectory τ‑recurrent w.r.t. \(h\ge0\) guarantees safety.  
- **Theorem 3 (Signed‑distance RCBF)**  
  Let \(h\) be a classical CBF satisfying two extra properties: (a) **Sector containment** – \(h\) remains bounded between two linear functions \(\alpha\,\|x\|-\beta\) and \(\beta\,\|x\|-\alpha\); (b) **Extended class‑K** as above.  
  For any closed set \(S\) with \(h\ge0\subseteq S\subseteq h\ge{-c}\) and \(\partial S\cap\{h=0\}=\emptyset\), the signed‑distance \(h_S(x)=-sd(x,S)\) is a valid RCBF over a slightly larger domain \(\hat D_0\) and with a possibly different \(\hat\gamma,\;\hat\tau\).  
- **Theorem 4 & 5 (Robust cell verification)**  
  Provide robust conditions on a ball \(B_r(x)\) that guarantee if *all* points in the ball satisfy the RCBF RHS or *none* do, using Lipschitz bounds on the dynamics.  
  These are the backbone of the *sampling* algorithm.  

### 6. Data‑driven Hints  

- Instead of solving a global SOS or PDE, the algorithm **samples a steady number \(n_s\) of control trajectories per cell**, each of length τ.  
- Two robust conditions \(C_s\) (safe) and \(C_u\) (unsafe) are checked:  
  * If *all* sampled trajectories satisfy \(C_u\) → cell is unsafe.  
  * Else if *some* satisfy \(C_s\) → cell is safe.  
  * Otherwise subdivide the cell.  

### 7. Algorithms  

- **Algorithm 1 – VerifyRegion**: orchestrates three stages, each calling *VerifyCells* with increasingly precise conditions:  
  1. Extend \(X_u\) via (13)/(14).  
  2. approximate \(R_\tau(\cup G_u)\) via (17)/(20).  
  3. build RCBF \(h=-sd(\cdot,S)\) with robust conditions (17)/(20).  

- **Algorithm 2 – VerifyCells**: iteratively splits the grid \(G\) into smaller cells, calling *SafetyCheck*.  

- **Algorithm 3 – SafetyCheck**: samples trajectories, checks \(C_u\) and \(C_s\), updates \(G_u\) or \(G_s\) or subdivides.  

- **Algorithm 4 – SplitCell**: partitions \(B_r(x)\) into \(3^n\) sub‑balls of radius \(r/3\).  

---

## Experiments / Data / Results  

### 1. Test System – 3‑D Evasion  

```
dot x = [v*cos(x_3), v*sin(x_3), u],  
x_1,x_2 ∈ ℝ² planar relative position,  
x_3 ∈ [0,2π] relative heading,  
v fixed, u∈[-1,1] angular speed,  
collision set: √(x_1² + x_2²) ≤ 1  (cylindrical unsafe region).  
```

Goal: compute the set of initial states that inevitably collide (i.e., cannot avoid the unsafe set).  

### 2. Parameter Settings  

| Parameter | Value | Explanation |
|-----------|-------|-------------|
| τ | 1 s | Recurrence horizon |
| n_s | 3 000 | Trajectories sampled per cell |
| α, β | 0.05 | Class‑K constants |

### 3. Metrics  

- **BRT volume** \(V_{BRT}\) from HJ reachability at various grid resolutions \(r_{\min}\).  
- **RCBF volume** \(V_{RCBF}\) as the union of safe cells.  
- **Intersection ratio** \(V_{RCBF}\cap h' \le0 / V_{BRT}\) (captures whether the RCBF region encloses the true unsafe set).  
- **Computation time** for both methods at each precision.

### 4. Results  

- **Table I – Unsafe Volume Capture**  

| r_min | 1.111 | 0.370 | 0.123 | 0.041 |  
|-------|--------|--------|--------|--------|  
| HJ BRT | 0.510 (✗) | 0.900 (✗) | 0.953 (✗) | 1 (✓) |  
| Recurrent Set | 1 (✓) | 1 (✓) | 1 (✓) | 1 (✓) |  

> HJ miss the unsafe region at coarse resolutions (under‑estimates).  RCBF always encloses the unsafe set regardless of resolution.

- **Table II – Computation Time**  

| r_min | 1.111 | 0.370 | 0.123 | 0.041 |  
|-------|--------|--------|--------|--------|  
| HJ BRT | 0.02 s (✗) | 0.19 s (✗) | 2.33 s (✗) | 83.73 s (✓) |  
| Recurrent Set | 0.13 s (✓) | 0.61 s (✓) | 3.19 s (✓) | 19.75 s (✓) |  

> RCBF beats HJ by orders of magnitude at high precision.

- **Fig. 2** – Contour plots compare unsafe region boundaries for various precisions and methods.  The RCBF envelope always contains the HJ result.  

- **Fig. 3** – τ‑accuracy vs. time trade‑off: decreasing τ reduces safe volume gap to zero but costs exponentially more time; α and β slightly affect both accuracy and run‑time.  

---

## Discussion & Analysis  

1. **Recurrence vs. Invariance** – RCBFs succeed even though the safe set need not be invariant; long‑run safety is preserved because trajectories return within τ, preventing eventual collision.  
2. **Signed‑distance as RCBF** – Theorem 3 shows that *if* we can bound a CBF \(h\) in a *sector*, then the signed distance to a set containing \(h\ge0\) suffices as an RCBF.  
3. **Sampling & Robustness** – Robust cell conditions (Theorem 5) cleanly bound the effect of Lipschitz drift, enabling *finite* trajectory checks to infer safety of an entire cell.  
4. **Interpretability & Parallelism** – The algorithm uses only trajectory simulation; no high‑dimensional SOS or HJ PDE; GPU‑friendly.  
5. **Accuracy** – The bounding by τ‑backward tube \(R_\tau(X_u)\) ensures over‑approximation; as τ→0 the RCBF set collapses to a CBF (classical invariance).  
6. **Computation vs. τ** – Exponential growth in \(3^n\) sub‑cells as τ decreases; yet runtime remains practical for moderate n (here 3‑D).  
7. **Connection to Prior Work** – Builds on [10] (generalized barrier functions with recurrence) and extends to *controlled* systems; unlike DeepReach or Koopman data‑driven methods, RCBF guarantees are *exact* (no approximate optimization).  

---

## Conclusions  

- **Recurrent Control Barrier Functions** generalize classical CBFs, requiring only finite‑time recurrences.  
- **Signed distance to a compact τ‑recurrent set** constitutes a non‑parametric RCBF, turning safety verification into a *set identification* problem.  
- **Sampling‑based algorithm** verifies safety at scale via robust constraints, tracing out safe absorbing sets efficiently and safely.  
- **Demonstrated performance** on a 3‑D evasion toy problem:  
  - Full coverage of unsafe region (≥ 100 %) for all grid precisions.  
  - Computation time orders of magnitude faster than HJ reachability at high resolution.  
- **Future work**: refine the link between sampling density, τ, and over‑approximation error; develop adaptive sampling policies to close the gap to the true safe set.  

---

## Key Claims & Contributions  

| Claim | Supporting Evidence | Reference |
|-------|-------------------|--------|
| RCBFs guarantee safety as long as the safe set excludes \(\mathcal R_\tau(X_u)\). | Theorem 2, proof via construction of τ‑recurrent control \(u\). | Sect. III‑B |
| Signed‑distance to a τ‑recurrent set is an RCBF. | Theorem 3, leveraging sector containment and extended class‑K bounds. | Sect. III‑C |
| Sampling‑based verification holds with finite trajectories. | Theorem 5, robustness conditions (17)/(20). | Sect. IV |
| Algorithm 1–4 provide scalable, parallel safety verification. | Complexity discussion in Experiments, time table (II). | Sect. V |
| RCBF over‑approximation always encloses true unsafe set (vs. HJ under‑estimation). | Table I, Fig. 2. | Sect. VI |  

---

## Definitions & Key Terms  

- **Hamilton–Jacobi Reachability (HJ Reachability)** – value‑function solving an HJ PDE gives maximal safe set.  
- **Control Barrier Function (CBF)** – \(h:X\to\mathbb R\) s.t. \(\dfrac{dh}{dt}\le\gamma(h)\).  
- **Extended Class‑K Function** – continuous, strictly increasing, \(\kappa(0)=0\).  
- **Signed Distance \(sd(x,S)\)** – \(\inf_{y\in S}\|x-y\| - \inf_{y\in S^c}\|x-y\|\).  
- **Control Recurrent Set** – contains every trajectory that starts in it.  
- **Control τ‑Recurrent Set** – every trajectory re‑enters within time τ.  
- **RCBF (Recurrent Control Barrier Function)** – \(h\) satisfying inequality (5).  
- **τ‑Backwards Reachable Tube \(R_\tau(S)\)** – all states from which S is reachable within τ‑time under *any* control.  
- **Sector Containment** – \(h\) bounded between two linear functions of \(\|x\|\).  

---

## Important Figures & Tables  

| Figure/Table | What it shows | Section |
|--------------|----------------|--------|
| **Figure 1** | Illustration of recurrent sets & trajectories | Sect. III‑A |
| **Figure 2** | Contour of unsafe region at various precisions; HJ vs. RCBF | Sect. VI‑A |
| **Figure 3** | Accuracy vs. τ trade‑off (volume gap & run‑time) | Sect. VI‑B |
| **Table I** | Unsafe volume capture ratio for HJ vs. RCBF | Sect. VI‑A |
| **Table II** | Computation time comparison | Sect. VI‑A |

---

## Limitations & Open Questions  

1. **Precision vs. τ trade‑off** – smaller τ gives tighter safety sets but the computational cost grows roughly \(O(3^n)\); exact cost vs. n not analytically bounded.  
2. **Sampling density to error mapping** – authors admit an *unknown* precise link; future work will quantify how many trajectories \(n_s\) and cell resolution \(r_{\min}\) guarantee a desired error bound.  
3. **GCash of current approach**—Relies on forward completeness & Lipschitz, which may not hold for some legacy dynamics, or for stochastic systems.  
4. **Scalability to high dimensions** – demonstrated in 3‑D; but not evaluated in >10 dimensions, where \(3^n\) subdivision may become unmanageable.  
5. **Robustness to control bounds** – The algorithm assumes \(\|u\|\leqsl\) fixed, but how to handle unbounded or state‑dependent input sets not fully explored.  

---

## References to Original Sections (if available)  

| Section | Content | Notes |
|---------|---------|-------|
| **III‑B** | Definition of RCBF and Theorem 2 (Safety Assessment) | Core safety theorem |
| **III‑C** | Theorem 3 (Signed‑distance RCBF) | Key constructive result |
| **IV** | Robust condition theorems (4,5) | Basis for sampling |
| **V** | Algorithm description | Overall verification pipeline |
| **VI** | Numerical results & evaluation | Proof of concept |
| **Appendix A** | Proof of Lemma 1 and discussions of technical lemmas | Where arguable bounds come from |

---

## Supplementary Material  

- *Appendix* proves Lemma 1 (finite‑time deviation bound), giving the constants needed in the robust cell inequalities.  
- *Algorithm 2–4* pseudocode provides implementation details for CUDA-friendly evaluation.  
- *Table II* illustrates hardware‑dependent performance, implicitly indicating the algorithm’s GPU amenability.  

---

### Executive Summary (Optional)  

- **Goal:** Fast, exact safety verification for nonlinear control systems.  
- **Core Idea:** Replace invariance with finite‑time recurrence; use signed distance to a recurrence set as a CBF.  
- **Method:** Sample many trajectories per small cell, use robust Lipschitz bounds to infer safety of the entire cell; recursively refine until all cells are classified.  
- **Result:** On a 3‑D evasion example, the method encloses the true unsafe region for any grid resolution while completing in tens of seconds even for high precision; this is ≈10× faster than empirical HJ solutions.  
- **Consequence:** The approach trades accuracy for computation in a predictable way, enabling large‑scale safety verification that is both safe and efficient.

---