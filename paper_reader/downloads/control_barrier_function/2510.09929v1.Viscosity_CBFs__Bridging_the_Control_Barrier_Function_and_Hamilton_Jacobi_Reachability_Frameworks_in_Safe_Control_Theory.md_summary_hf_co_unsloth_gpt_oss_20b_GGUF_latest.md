**Title & Citation**  
Viscosity CBFs: Bridging the Control Barrier Function and Hamilton–Jacobi Reachability Frameworks in Safe Control Theory  
Dylan Hirsch, Jaime Fernández Fisac, and Sylvia Herbert  

---

### Abstract  
The paper introduces **viscosity control barrier functions (viscosity CBFs)**—a weak‑solution generalisation of standard CBFs that need not be continuously differentiable.  It establishes a deep equivalence between viscosity CBFs, **control barrier value functions (CB–VFs)**, and the Hamilton–Jacobi–reachability (HJR) value functions.  The main contributions are:  

* A rigorous definition of viscosity CBFs using the classical viscosity–solution framework.  
* A proof that a viscosity CBF with respect to a class‑K function α is exactly a time‑invariant CB–VF and, equivalently, a function that gives the “Barrier Guarantee” (control invariance plus a bound on the speed of approach to the set boundary).  
* Demonstration that viscosity CBFs are closed under taking maxima and pointwise limits, thus enabling systematic synthesis.  
* An extension of CB‑VFs to non‑exponential anti‑discounting given by arbitrary locally‑Lipschitz class‑K anti‑discount functions.  

These results bring CBF theory into the HJR framework, opening the door to using the rich viscosity–solution machinery (e.g. comparison principles, uniqueness) for constructing and analysing CBFs.

---

### Introduction & Motivation  
* Safe control often relies on two pillars: Control Barrier Functions (CBFs) and Hamilton–Jacobi Reachability (HJR).  
* CBFs encode safety via a pointwise inequality; HJR produces scalar value functions as solutions of HJ equations that guarantee reachability/avoidance.  
* Previously, a “control barrier value function” (CB‑VF) was defined as an anti‑discounted avoid‐value.  That work still used only exponential anti‑discounting.  
* The authors observe that **viscosity CBFs** generalise existing non‑differentiable CBFs ([9],[10]), and argue they are precisely the time‑invariant CB‑VFs, thereby **bridging** the seemingly separate CBF and HJR theories.  

---

### Methods / Approach  

| Concept | Definition (excerpt) | Key Points |
|---------|----------------------|-------------|
| **Class‑K** | α: ℝ_≥0 → ℝ_≥0, continuous, strictly increasing, α(0)=0 | |
| **Class‑KL** | β: ℝ_≥0 × ℝ_≥0 → ℝ_≥0, continuous, β(·,t)∈K, β(r,·) non‑increasing, β(r,·)→0 as t→∞ | |
| **Control‑Invariant Set** | S⊆ℝ^n such that for every x∈S there exists u∈U with trajectory staying in S.| |
| **Control Barrier Function (Traditional)** | h:ℝ^n→ℝ, C^1, 〈∇h, f(x,u)〉+α(h(x))≥0 for all x, u∈U; inequality required only for h(x)>0. | |
| **Viscosity CBF** | h continuous; for all x with h(x)>0 and all C^1 test functions φ with h−φ having a local max at x,  
     ⌊∇φ(x), f(x,u)⌋ + α(h(x)) ≥ 0 ∀u∈U. | Requires “viscosity sense” rather than classical differentiability. |
| **CB‑VF** | g:ℝ^n→ℝ_≥0 continuous. Define v(x,T) implicitly by the anti‑discounted dynamic programming equation:  
     v(x,T)=sup_{u(·)} min_{t∈[0,T]} β_α(v(x,u·x(t)), T−t), where β_α solves \dot y = –α(y). | |
| **Barrier Guarantee** | B continuous: for all θ∈[0,1) and all x with B(x)>0, ∃ u(·) s.t. for all t≥0, β_α(θ B(x), t)≤B(x,u·x(t)). | Implies control invariance of {B>0} and bounds approach speed. |

* **Hamiltonian** H_α(x,λ,p)=max_{u∈U} λ 〈p, f(x,u)〉 + λ α(λ).  
  The PDE for viscosity CBF is –H_α(x, h(x), ∇h(x))=0 in viscosity sense.

---

### Experiments / Data / Results  
The work is purely theoretical.  No simulation or numerical data are presented; proofs are given in the appendices.  Illustrative figures include:  

* **Figure 1** – Graphical abstract showing the flow from standard CBF→viscosity CBF→CB‑VF (time‑invariant) and the equivalence with HJ PDE.  
* **Figure 2** – Cartoon of level sets of a typical immediate safety function g.  Indistinction between positive/negative regions.  

---

### Discussion & Analysis  

* **Equivalence Theorem (Theorem 2)**: For α locally‑Lipschitz K and h continuous and non‑negative, the following are equivalent:  
  1) h is a viscosity CBF w.r.t. α.  
  2) h is a viscosity sub‑solution of –H_α(x,h(x),∇h)=0.  
  3) The CB‑VF corresponding to h is time‑invariant (v(·,T)≡h).  
  4) h gives the Barrier Guarantee.  
Thus all four notions coincide.  
* **Proof Sketch**: (1)→(2) uses Lemma 3.  (2)→(3) via Theorem 1 (CB‑VF solves HJ PDE). (3)→(4) uses the dynamic programming inequality to construct a feedback proving the Barrier Guarantee.  
* **Key Consequence**: The Barrier Guarantee is the *only* property needed for safety: control invariance *and* bounded approach.  
* **CB‑VF Extension**: Anti‑discounting can be any locally‑Lipschitz K, not just exponential α(r)=γr.  
* **Synthesis Properties**:  
  – *Max Closure* (Theorem 3): max of two viscosity CBFs is a viscosity CBF.  
  – *Limit Closure* (Theorem 4): Uniform limits of viscosity CBFs are viscosity CBFs; equally holds if dynamics vary.  

---

### Conclusions  

- Viscosity CBFs generalise traditional CBFs to allow nondifferentiable functions while preserving safety guarantees.  
- They exactly correspond to time‑invariant CB‑VFs, thereby unifying HJR and CBF approaches.  
- This reveals that safety analysis can be formulated as a *viscosity PDE* problem; many existing results (existence, uniqueness, comparison principles) now apply to CBF design.  
- The paper opens possibilities for *computational* CBF synthesis via numerical PDE solvers and suggests future work on exact synthesis procedures and further structural properties (e.g., concatenations, other anti‑discounting forms).  

---

### Key Claims & Contributions  

1. **Definition of viscosity CBFs** (weak‑solution notion) and proof that they are a subclass of non‑differentiable CBFs.  
2. **Bridge Theorem**: Viscosity CBF ≡ time‑invariant CB‑VF ≡ viscosity sub‑solution of –H_α.  
3. **Barrier Guarantee Characterisation**: Continuous functions giving the Barrier Guarantee are exactly viscosity CBFs.  
4. **CB‑VF Generalisation**: Anti‑discounting via arbitrary locally‑Lipschitz class‑K functions α.  
5. **Closure Properties**: Max and uniform limit preserve viscosity CBFs.  

---

### Definitions & Key Terms  

| Term | Reference | Explanation |
|------|-----------|-------------|
| **Hamilton–Jacobi PDE** | HJ‑PDE: \(\mathcal{H}(x,v,\nabla v)=0\). | PDE whose viscosity solutions are optimal value functions. |
| **Viscosity Sub‑/Super‑Solution** | Definition 7 | Weak notion: behaviour only through test functions φ. |
| **CB‑VF** | Definition 6 | Anti‑discounted avoid value, defined by dynamic programming inequality. |
| **Barrier Guarantee** | Definition 5 | Continuous B such that \(\beta_\alpha(\theta B(x),t)\le B(x,u\!x(t))\); gives invariance and approach bounds. |
| **Viscosity CBF** | Definition 6 | Continuous h satisfying inequality (in viscosity sense) at points where h>0. |
| **Class‑K/CL-Class** | Definition 1/2 | Standard class‑K/CL functions from nonlinear systems theory. |
| **Hamiltonian \(H_\alpha\)** | Eq. (5) | \(H_\alpha(x,\lambda,p)=\max_{u\in U} (\lambda\langle p,f(x,u)\rangle + \lambda\alpha(\lambda))\). |
| **CB‑VF Value** | Eq. (7) | \(v(x,T)=\sup_{u(\cdot)}\min_{t\in[0,T]}\beta_\alpha(v(x,u\cdot x(t)),T-t)\). |

---

### Important Figures & Tables  

* **Figure 1 – Graphical Abstract**: Illustrates the conceptual flow: Traditional CBF → Viscosity CBF ↔ CB‑VF → HJ PDE.  Ok – it shows that a standard CBF is a viscosity CBF (trivial); viscosity CBFs are precisely CB‑VFs that are time‑invariant; CB‑VFs are solutions of a HJ PDE with a particular Hamiltonian.  

* **Figure 2 – Immediate Safety Function**: 2‑D cartoon of g with level sets showing the safety region (g>0).  This visualises the immediate safety function used to define CB‑VFs.  

No tables are present in the paper.  

---

### Limitations & Open Questions  

| Issue | Discussion |
|-------|------------|
| **Existence Range** | Viscosity CBF existence requires continuity and local Lipschitz class‑K α; not proven for all α (e.g. very fast growth). |
| **Constructive Synthesis** | While closed under max/limits, no algorithmic method is provided to *construct* a viscosity CBF from scratch; relies on existence of CB‑VF solutions. |
| **Computational Realisation** | Solving the HJ PDE numerically for high‑dimensional systems remains challenging; concrete discretisation or neural‑network approximations are left for future work. |
| **Non‑control‑affine Systems** | The theory assumes measurement‑invariant dynamics but not arbitrary distributions on control; extension to discontinuous control sets is unclear. |
| **Extensions to Time‑Varying or Stochastic Dynamics** | Speed‑up possible but not covered in this paper. |

---

### References to Original Sections  

* **Classifier Definitions** – Section II (Definitions 1‑4).  
* **Barrier Guarantee** – Definition 5, Section III.  
* **Viscosity CBF** – Definition 6, Section IV‑A.  
* **CB‑VF** – Definition 6 (second part), Section IV‑B.  
* **Theorem 1** – Section V, characterising CB‑VFs as viscosity solutions.  
* **Theorem 2** – Section V, equivalence of viscosity CBF ↔ CB‑VF ↔ Barrier Guarantee.  
* **Theorem 3** – Section VI, closure under max.  
* **Theorem 4** – Section VI, closure under limits.  
* **Counter‑example** – Appendix C (Control invariance counter‑example).  

---

### Executive Summary (Optional)  

1. Introduced viscosity CBFs: non‑differentiable CBFs defined in the viscosity sense.  
2. Shown equivalence between viscosity CBFs, CB‑VFs and barrier guarantees; all are characterised by a single HJ PDE.  
3. Extended CB‑VFs to general locally‑Lipschitz class‑K anti‑discounting.  
4. Demonstrated closure under maximum and uniform limits.  
5. Provided rigorous proofs (Appendix B/C) and a counter‑example to non‑strict zero invariance.  

---

### Supplementary Material (Not Provided)  

The paper contains no appendices beyond the proofs, no code or data repositories, and no supplementary figures.  The proofs are fully embedded in the appendices of the manuscript.